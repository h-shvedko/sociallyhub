// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// CORE ENTITIES
// ========================================

model Workspace {
  id               String   @id @default(cuid())
  name             String
  timezone         String   @default("UTC")
  branding         Json?    // Store workspace branding (logo, colors, etc.)
  defaultLocale    String   @default("en")
  supportedLocales String[] @default(["en"])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  users          UserWorkspace[]
  clients        Client[]
  socialAccounts SocialAccount[]
  posts          Post[]
  campaigns      Campaign[]
  campaignReports CampaignReport[]
  assets         Asset[]
  templates      Template[]
  inboxItems     InboxItem[]
  auditEvents    AuditEvent[]
  analytics      AnalyticsMetric[] @relation("WorkspaceAnalytics")
  
  // AI Relations
  aiSuggestions     AIContentSuggestion[] @relation("WorkspaceAISuggestions")
  aiUsage           AIUsageTracking[]     @relation("WorkspaceAIUsage")
  hashtagSuggestions HashtagSuggestion[]  @relation("WorkspaceHashtagSuggestions")
  
  // Visual Analytics Relations
  imageAnalysis     ImageAnalysis[]       @relation("WorkspaceImageAnalysis")
  imageOptimizations ImageOptimization[]  @relation("WorkspaceImageOptimization")
  visualMetrics     VisualPerformanceMetric[] @relation("WorkspaceVisualMetrics")
  brandGuidelines   BrandVisualGuideline[] @relation("WorkspaceBrandGuidelines")
  imageABTests      ImageABTest[]         @relation("WorkspaceImageABTests")
  
  // Audience Intelligence Relations
  sentimentAnalysis     SentimentAnalysis[]        @relation("WorkspaceSentimentAnalysis")
  sentimentTrends       SentimentTrend[]           @relation("WorkspaceSentimentTrends")
  crisisAlerts          CrisisAlert[]              @relation("WorkspaceCrisisAlerts")
  audienceSegments      AudienceSegment[]          @relation("WorkspaceAudienceSegments")
  contentRecommendations ContentRecommendation[]   @relation("WorkspaceContentRecommendations")
  postingRecommendations PostingTimeRecommendation[] @relation("WorkspacePostingRecommendations")
  engagementPatterns    EngagementPattern[]        @relation("WorkspaceEngagementPatterns")
  
  // Advanced Automation Relations
  trendAnalysis         TrendAnalysis[]             @relation("WorkspaceTrendAnalysis")
  contentGapAnalysis    ContentGapAnalysis[]        @relation("WorkspaceContentGapAnalysis")
  competitorAnalysis    CompetitorAnalysis[]        @relation("WorkspaceCompetitorAnalysis")
  contentSuggestions    ContentSuggestion[]         @relation("WorkspaceContentSuggestions")
  smartResponses        SmartResponse[]             @relation("WorkspaceSmartResponses")
  automationRules       AutomationRule[]            @relation("WorkspaceAutomationRules")
  automationExecutions  AutomationExecution[]       @relation("WorkspaceAutomationExecutions")
  calendarOptimizations ContentCalendarOptimization[] @relation("WorkspaceCalendarOptimizations")
  translations          Translation[]               @relation("WorkspaceTranslations")
  responseTemplates     ResponseTemplate[]          @relation("WorkspaceResponseTemplates")
  
  // A/B Testing Relations
  contentABTests        ContentABTest[]             @relation("WorkspaceContentABTests")
  
  // Translation Relations
  translationCache      TranslationCache[]          @relation("WorkspaceTranslationCache")
  contentTranslations   WorkspaceContentTranslation[] @relation("WorkspaceContentTranslations")
  
  // Custom Dashboard Relations
  customDashboards      CustomDashboard[] @relation("WorkspaceCustomDashboards")

  @@map("workspaces")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  emailVerified DateTime?
  name          String?
  image         String?
  password      String?
  twoFactorEnabled Boolean @default(false)
  timezone      String?  @default("UTC")
  locale        String?  @default("en")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  workspaces      UserWorkspace[]
  accounts        Account[]
  sessions        Session[]
  assignedInboxItems InboxItem[] @relation("AssignedTo")
  notifications   Notification[]
  auditEvents     AuditEvent[]
  createdPosts    Post[]
  approvedPosts   Post[] @relation("ApprovedBy")
  analytics       AnalyticsMetric[] @relation("UserAnalytics")
  userSessions    UserSession[] @relation("UserSessions")
  userActions     UserAction[] @relation("UserActions")
  
  // AI Relations
  aiSuggestions   AIContentSuggestion[] @relation("UserAISuggestions")
  
  // Translation Relations
  languagePreferences  UserLanguagePreference[] @relation("UserLanguagePreferences")
  translatedContent    WorkspaceContentTranslation[] @relation("ContentTranslatedBy")
  
  // Custom Dashboard Relations
  customDashboards     CustomDashboard[] @relation("UserCustomDashboards")
  aiUsage         AIUsageTracking[]     @relation("UserAIUsage")

  @@map("users")
}

model UserWorkspace {
  id          String      @id @default(cuid())
  userId      String
  workspaceId String
  role        WorkspaceRole
  permissions Json        // Store granular permissions
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId])
  @@map("user_workspaces")
}

model Client {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  email       String
  phone       String?
  company     String?
  industry    String?
  website     String?
  logo        String?
  status      String   @default("ACTIVE")
  notes       String?
  labels      String[] // Tags for client organization
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace      Workspace       @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccounts SocialAccount[]
  posts          Post[]
  campaigns      Campaign[]

  @@map("clients")
}

model SocialAccount {
  id           String              @id @default(cuid())
  workspaceId  String
  clientId     String?
  provider     SocialProvider
  accountType  String              // "page", "profile", "channel", etc.
  handle       String              // @username or page name
  displayName  String
  accountId    String              // Provider's account ID
  accessToken  String              // Encrypted
  refreshToken String?             // Encrypted
  tokenExpiry  DateTime?
  scopes       String[]            // What permissions we have
  status       SocialAccountStatus @default(ACTIVE)
  metadata     Json?               // Provider-specific data
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  workspace    Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)
  postVariants PostVariant[]
  inboxItems   InboxItem[]
  metrics      AnalyticsMetric[]

  @@unique([provider, accountId, workspaceId])
  @@map("social_accounts")
}

// ========================================
// CONTENT & PUBLISHING
// ========================================

model Post {
  id          String     @id @default(cuid())
  workspaceId String
  clientId    String?
  title       String?
  baseContent String?    // Master content before platform customization
  link        String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  campaignId  String?
  tags        String[]
  status      PostStatus @default(DRAFT)
  ownerId     String     // User who created the post
  approverId  String?    // User who approved (if approval required)
  scheduledAt DateTime?
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  workspace    Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)
  owner        User          @relation(fields: [ownerId], references: [id])
  approver     User?         @relation("ApprovedBy", fields: [approverId], references: [id])
  campaign     Campaign?     @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  variants     PostVariant[]
  assets       PostAsset[]
  metrics      AnalyticsMetric[]
  
  // AI Relations
  aiSuggestions          AIContentSuggestion[]       @relation("PostAISuggestions")
  performancePrediction  ContentPerformancePrediction? @relation("PostPerformancePrediction")
  toneAnalysis          ContentToneAnalysis?        @relation("PostToneAnalysis")
  
  // Visual Analytics Relations
  visualMetrics         VisualPerformanceMetric[]   @relation("PostVisualMetrics")
  
  // Audience Intelligence Relations
  sentimentAnalysis     SentimentAnalysis[]         @relation("PostSentimentAnalysis")

  @@map("posts")
}

model PostVariant {
  id              String         @id @default(cuid())
  postId          String
  socialAccountId String
  text            String?
  hashtags        String[]
  platformData    Json?          // Platform-specific fields (YouTube title, etc.)
  status          VariantStatus  @default(PENDING)
  providerPostId  String?        // ID from the social platform after publishing
  publishedAt     DateTime?
  failureReason   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  post          Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  @@unique([postId, socialAccountId])
  @@map("post_variants")
}

model PostAsset {
  id      String @id @default(cuid())
  postId  String
  assetId String

  post  Post  @relation(fields: [postId], references: [id], onDelete: Cascade)
  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([postId, assetId])
  @@map("post_assets")
}

model Asset {
  id           String    @id @default(cuid())
  workspaceId  String
  filename     String
  originalName String
  mimeType     String
  size         Int       // File size in bytes
  url          String    // Storage URL
  thumbnailUrl String?   // Thumbnail for videos/images
  width        Int?      // Image/video width
  height       Int?      // Image/video height
  duration     Float?    // Video duration in seconds
  metadata     Json?     // EXIF, transcoding status, etc.
  tags         String[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  workspace Workspace   @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  posts     PostAsset[]
  
  // Visual Analytics Relations
  imageAnalysis     ImageAnalysis?      @relation("AssetImageAnalysis")
  performanceMetrics VisualPerformanceMetric[] @relation("AssetPerformanceMetrics")
  originalOptimizations ImageOptimization[] @relation("OriginalAsset")
  optimizedVersions     ImageOptimization[] @relation("OptimizedAsset")
  abTestControl         ImageABTest[]       @relation("ABTestControlAsset")

  @@map("assets")
}

model Template {
  id          String          @id @default(cuid())
  workspaceId String
  name        String
  description String?
  content     String          // Template content with variables
  variables   String[]        // List of variables like ["product", "url"]
  platforms   SocialProvider[] @default([]) // Platforms this template is designed for
  tags        String[]        @default([]) // Tags for organization
  type        TemplateType    @default(POST)
  isGlobal    Boolean         @default(false) // Global vs personal templates
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("templates")
}

model Campaign {
  id          String   @id @default(cuid())
  workspaceId String
  clientId    String?
  name        String
  description String?
  status      String   @default("DRAFT") // DRAFT, SCHEDULED, ACTIVE, PAUSED, COMPLETED, CANCELLED
  type        String   @default("CUSTOM") // BRAND_AWARENESS, LEAD_GENERATION, ENGAGEMENT, etc.
  startDate   DateTime?
  endDate     DateTime?
  objectives  Json?    // Campaign goals and KPIs
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  posts     Post[]

  @@map("campaigns")
}

model CampaignReport {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  description String?
  type        String   // PERFORMANCE, EXECUTIVE, DETAILED, AB_TEST, CUSTOM
  format      String   // PDF, EXCEL, CSV, HTML
  frequency   String   // ON_DEMAND, DAILY, WEEKLY, MONTHLY
  campaigns   Json     // Array of campaign IDs
  sections    Json     // Included report sections
  recipients  String?  // Email recipients
  status      String   @default("READY") // READY, GENERATING, COMPLETED, FAILED
  downloadUrl String?
  generatedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("campaign_reports")
}

// ========================================
// INBOX & CONVERSATIONS
// ========================================

model InboxItem {
  id               String         @id @default(cuid())
  workspaceId      String
  socialAccountId  String
  type             InboxItemType
  providerThreadId String?        // Thread ID from social platform
  providerItemId   String         // Comment/message ID from platform
  content          String
  authorName       String?
  authorHandle     String?
  authorAvatar     String?
  sentiment        String?        // "positive", "negative", "neutral"
  status           InboxStatus    @default(OPEN)
  assigneeId       String?        // Assigned team member
  tags             String[]
  internalNotes    String?
  slaBreachedAt    DateTime?      // When SLA was breached
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  workspace     Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
  assignee      User?         @relation("AssignedTo", fields: [assigneeId], references: [id], onDelete: SetNull)
  conversation  Conversation?

  @@unique([providerItemId, socialAccountId])
  @@map("inbox_items")
}

model Conversation {
  id          String @id @default(cuid())
  inboxItemId String @unique
  threadData  Json?  // Full conversation thread from platform

  inboxItem InboxItem @relation(fields: [inboxItemId], references: [id], onDelete: Cascade)

  @@map("conversations")
}

// ========================================
// ANALYTICS & METRICS
// ========================================

model AnalyticsMetric {
  id              String         @id @default(cuid())
  workspaceId     String?        // For workspace-level filtering  
  userId          String         // User-level analytics
  socialAccountId String?        // Account-specific metrics
  postId          String?        // Post-specific metrics
  date            DateTime       @db.Date
  hour            Int?           // Hour of day (0-23) for hourly metrics
  platform        SocialProvider?
  metricType      String         // "impressions", "reach", "likes", "comments", "page_view", "session", etc.
  value           Float
  dimensions      Json?          // Additional dimensions (campaign, post_type, etc.)
  metadata        Json?          // Additional metadata
  createdAt       DateTime       @default(now())

  user          User           @relation("UserAnalytics", fields: [userId], references: [id], onDelete: Cascade)
  workspace     Workspace?     @relation("WorkspaceAnalytics", fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount? @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
  post          Post?          @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, socialAccountId, postId, date, hour, metricType])
  @@index([workspaceId, date])
  @@index([userId, date])
  @@index([postId, metricType])
  @@map("analytics_metrics")
}

// User sessions for analytics
model UserSession {
  id           String    @id @default(cuid())
  userId       String
  startTime    DateTime
  endTime      DateTime?
  lastActivity DateTime
  duration     Int?      // Session duration in seconds
  userAgent    String?
  ip           String?
  pages        String[]  // Pages visited during session
  metadata     Json?     // Additional session data
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user User @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, startTime])
  @@index([lastActivity])
  @@map("user_sessions")
}

// User actions for detailed analytics
model UserAction {
  id         String   @id @default(cuid())
  userId     String
  actionType String   // "click", "view", "create", "update", "delete", etc.
  timestamp  DateTime
  details    Json?    // Action-specific details
  duration   Int?     // Time taken for action in milliseconds
  createdAt  DateTime @default(now())

  user User @relation("UserActions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([actionType, timestamp])
  @@map("user_actions")
}

// Alerts for monitoring system
model Alert {
  id          String    @id @default(cuid())
  ruleId      String    // ID of the alert rule that triggered this
  title       String
  description String
  severity    String    // "low", "medium", "high", "critical"
  timestamp   DateTime
  resolved    Boolean   @default(false)
  resolvedAt  DateTime?
  metadata    Json?     // Alert-specific data
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([resolved, timestamp])
  @@index([severity, timestamp])
  @@map("alerts")
}

// ========================================
// SYSTEM & NOTIFICATIONS
// ========================================

model Notification {
  id          String             @id @default(cuid())
  userId      String
  type        NotificationType
  title       String
  message     String
  data        Json?              // Additional notification data
  status      NotificationStatus @default(UNREAD)
  deliveredAt DateTime?
  readAt      DateTime?
  createdAt   DateTime           @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model AuditEvent {
  id          String   @id @default(cuid())
  workspaceId String
  userId      String?  // Can be null for system events
  action      String   // "create", "update", "delete", "publish", etc.
  resource    String   // "post", "account", "user", etc.
  resourceId  String?  // ID of the affected resource
  oldValues   Json?    // Previous state
  newValues   Json?    // New state
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([workspaceId, createdAt])
  @@index([userId, createdAt])
  @@map("audit_events")
}

// ========================================
// NEXT-AUTH MODELS
// ========================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ========================================
// ENUMS
// ========================================

enum WorkspaceRole {
  OWNER
  ADMIN
  PUBLISHER
  ANALYST
  CLIENT_VIEWER
}

enum SocialProvider {
  TWITTER
  FACEBOOK
  INSTAGRAM
  LINKEDIN
  YOUTUBE
  TIKTOK
}

enum SocialAccountStatus {
  ACTIVE
  TOKEN_EXPIRED
  REVOKED
  ERROR
}

enum PostStatus {
  DRAFT
  IN_REVIEW
  APPROVED
  SCHEDULED
  PUBLISHED
  FAILED
  CHANGES_REQUESTED
  ARCHIVED
}

enum VariantStatus {
  PENDING
  SCHEDULED
  PUBLISHED
  FAILED
}

enum InboxItemType {
  COMMENT
  MENTION
  DIRECT_MESSAGE
  REVIEW
  REPLY
}

enum InboxStatus {
  OPEN
  ASSIGNED
  SNOOZED
  CLOSED
}

enum TemplateType {
  POST
  RESPONSE
}

enum NotificationType {
  APPROVAL_REQUESTED
  APPROVAL_GRANTED
  APPROVAL_DENIED
  PUBLISH_SUCCESS
  PUBLISH_FAILED
  TOKEN_EXPIRING
  TOKEN_EXPIRED
  INBOX_ASSIGNMENT
  SLA_BREACH
  REPORT_READY
}

enum NotificationStatus {
  UNREAD
  READ
  DISMISSED
}

// ========================================
// AI FEATURES
// ========================================

model AIContentSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  userId          String
  originalContent String?
  suggestedContent String
  suggestionType  AISuggestionType
  platform        SocialProvider?
  confidenceScore Float?
  used            Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace @relation("WorkspaceAISuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User      @relation("UserAISuggestions", fields: [userId], references: [id], onDelete: Cascade)
  post      Post?     @relation("PostAISuggestions", fields: [postId], references: [id], onDelete: Cascade)
  postId    String?

  @@map("ai_content_suggestions")
}

model ContentPerformancePrediction {
  id                         String   @id @default(cuid())
  postId                     String   @unique
  predictedEngagementRate    Float?
  predictedReach             Int?
  predictedImpressions       Int?
  predictedLikes             Int?
  predictedComments          Int?
  predictedShares            Int?
  confidenceScore            Float?
  actualEngagementRate       Float?
  actualReach                Int?
  actualImpressions          Int?
  actualLikes                Int?
  actualComments             Int?
  actualShares               Int?
  predictionAccuracy         Float?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt

  // Relations
  post Post @relation("PostPerformancePrediction", fields: [postId], references: [id], onDelete: Cascade)

  @@map("content_performance_predictions")
}

model AIUsageTracking {
  id            String   @id @default(cuid())
  workspaceId   String
  userId        String
  featureType   AIFeatureType
  tokensUsed    Int?
  costCents     Int?
  responseTimeMs Int?
  model         String?
  successful    Boolean  @default(true)
  errorMessage  String?
  createdAt     DateTime @default(now())

  // Relations
  workspace Workspace @relation("WorkspaceAIUsage", fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User      @relation("UserAIUsage", fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_usage_tracking")
}

model AIModelVersion {
  id          String   @id @default(cuid())
  name        String
  version     String
  provider    AIProvider
  isActive    Boolean  @default(true)
  configuration Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([name, version])
  @@map("ai_model_versions")
}

model HashtagSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  hashtag         String
  platform        SocialProvider
  trendingScore   Float?
  performanceScore Float?
  category        String?
  isBlocked       Boolean  @default(false)
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())

  // Relations
  workspace Workspace @relation("WorkspaceHashtagSuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, hashtag, platform])
  @@map("hashtag_suggestions")
}

model ContentToneAnalysis {
  id          String   @id @default(cuid())
  postId      String   @unique
  tone        ContentTone
  confidence  Float?
  sentiment   Float?    // -1 to 1 (negative to positive)
  formality   Float?    // 0 to 1 (informal to formal)
  energy      Float?    // 0 to 1 (low to high energy)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  post Post @relation("PostToneAnalysis", fields: [postId], references: [id], onDelete: Cascade)

  @@map("content_tone_analysis")
}

// ========================================
// AI ENUMS
// ========================================

enum AISuggestionType {
  HASHTAGS
  CAPTION
  TONE_ADJUSTMENT
  OPTIMIZATION
  TRANSLATION
}

enum AIFeatureType {
  CONTENT_GENERATION
  HASHTAG_SUGGESTION
  TONE_ANALYSIS
  PERFORMANCE_PREDICTION
  IMAGE_ANALYSIS
  TRANSLATION
}

enum AIProvider {
  OPENAI
  ANTHROPIC
  GOOGLE
  AZURE
}

enum ContentTone {
  PROFESSIONAL
  CASUAL
  HUMOROUS
  INSPIRATIONAL
  EDUCATIONAL
  PROMOTIONAL
  CONVERSATIONAL
  FORMAL
}

// ========================================
// VISUAL CONTENT ANALYTICS
// ========================================

model ImageAnalysis {
  id               String   @id @default(cuid())
  assetId          String   @unique
  workspaceId      String
  
  // Image Properties
  width            Int
  height           Int
  format           String
  fileSize         Int
  dominantColors   Json     // Array of hex colors
  colorPalette     Json     // Full color analysis
  
  // AI Analysis
  labels           Json     // Detected objects/concepts
  faces            Json     // Face detection results
  text             Json     // OCR results
  safeSearch       Json     // Safe search annotations
  landmarks        Json     // Landmark detection
  
  // Brand Analysis
  brandScore       Float?   // Brand consistency score (0-1)
  logoDetected     Boolean  @default(false)
  brandColors      Json?    // Detected brand colors
  fontAnalysis     Json?    // Text overlay analysis
  
  // Performance Metrics
  aestheticScore   Float?   // Aesthetic quality score (0-1)
  compositonScore  Float?   // Composition analysis score (0-1)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  asset       Asset     @relation("AssetImageAnalysis", fields: [assetId], references: [id], onDelete: Cascade)
  workspace   Workspace @relation("WorkspaceImageAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("image_analysis")
}

model ImageOptimization {
  id               String   @id @default(cuid())
  originalAssetId  String
  optimizedAssetId String?
  workspaceId      String
  platform         SocialProvider
  
  // Optimization Settings
  targetWidth      Int?
  targetHeight     Int?
  compressionLevel Float?   // 0-1
  format           String?  // jpg, png, webp
  
  // Applied Optimizations
  cropped          Boolean  @default(false)
  resized          Boolean  @default(false)
  compressed       Boolean  @default(false)
  filtered         Boolean  @default(false)
  textOverlay      Boolean  @default(false)
  
  // Optimization Results
  sizeBefore       Int
  sizeAfter        Int?
  qualityScore     Float?   // Quality assessment after optimization
  
  // Performance Impact
  loadTimeImprovement Float? // Seconds saved
  engagementPredict   Float? // Predicted engagement improvement
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  originalAsset  Asset     @relation("OriginalAsset", fields: [originalAssetId], references: [id], onDelete: Cascade)
  optimizedAsset Asset?    @relation("OptimizedAsset", fields: [optimizedAssetId], references: [id], onDelete: SetNull)
  workspace      Workspace @relation("WorkspaceImageOptimization", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("image_optimizations")
}

model VisualPerformanceMetric {
  id              String   @id @default(cuid())
  assetId         String
  postId          String?
  workspaceId     String
  platform        SocialProvider?
  
  // Visual Metrics
  viewDuration    Float?   // Average view time in seconds
  clickThroughRate Float?  // CTR for images with links
  saveRate        Float?   // Rate of saves/downloads
  shareRate       Float?   // Rate of shares
  
  // Engagement Correlation
  likesPerView    Float?
  commentsPerView Float?
  engagementRate  Float?
  
  // Visual Factors
  colorScore      Float?   // Color harmony score
  compositionScore Float?  // Rule of thirds, balance, etc.
  contrastScore   Float?   // Visual contrast analysis
  
  // A/B Testing
  testVariant     String?  // A/B test variant identifier
  testGroup       String?  // Control/test group
  
  recordedAt      DateTime @default(now())
  createdAt       DateTime @default(now())

  // Relations
  asset     Asset      @relation("AssetPerformanceMetrics", fields: [assetId], references: [id], onDelete: Cascade)
  post      Post?      @relation("PostVisualMetrics", fields: [postId], references: [id], onDelete: Cascade)
  workspace Workspace  @relation("WorkspaceVisualMetrics", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("visual_performance_metrics")
}

model BrandVisualGuideline {
  id              String   @id @default(cuid())
  workspaceId     String
  name            String
  
  // Brand Colors
  primaryColors   Json     // Primary brand colors (hex)
  secondaryColors Json     // Secondary colors
  accentColors    Json     // Accent colors
  
  // Typography
  primaryFonts    Json     // Primary font stack
  secondaryFonts  Json     // Secondary fonts
  fontSizes       Json     // Approved font sizes
  
  // Logo Guidelines
  logoVariants    Json     // Different logo versions
  logoMinSize     Json     // Minimum size requirements
  logoClearSpace  Json     // Clear space requirements
  
  // Visual Style
  filterSettings  Json?    // Approved filters/effects
  overlayStyles   Json?    // Text overlay styles
  compositionRules Json?   // Composition guidelines
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace @relation("WorkspaceBrandGuidelines", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("brand_visual_guidelines")
}

model VisualTrend {
  id              String   @id @default(cuid())
  platform        SocialProvider
  category        String   // e.g., "color", "composition", "style"
  trendName       String
  description     String?
  
  // Trend Data
  popularity      Float    // Popularity score (0-1)
  growthRate      Float?   // Week-over-week growth
  peakDate        DateTime?
  
  // Visual Characteristics
  characteristics Json     // Key visual characteristics
  examples        Json?    // Example image URLs or descriptions
  
  // Geographic/Demographic Data
  regions         Json?    // Popular regions
  demographics    Json?    // Age groups, interests
  
  detectedAt      DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([platform, category, trendName])
  @@map("visual_trends")
}

model ImageABTest {
  id              String   @id @default(cuid())
  workspaceId     String
  testName        String
  description     String?
  
  // Test Configuration
  platform        SocialProvider?
  startDate       DateTime
  endDate         DateTime?
  status          ABTestStatus @default(RUNNING)
  
  // Test Assets
  controlAssetId  String
  variantAssetIds Json     // Array of variant asset IDs
  
  // Results
  totalViews      Int      @default(0)
  controlViews    Int      @default(0)
  controlEngagement Float?
  winningVariant  String?  // Asset ID of winning variant
  confidenceLevel Float?   // Statistical confidence (0-1)
  
  // Insights
  insights        Json?    // AI-generated insights
  recommendations Json?    // Optimization recommendations
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace     Workspace @relation("WorkspaceImageABTests", fields: [workspaceId], references: [id], onDelete: Cascade)
  controlAsset  Asset     @relation("ABTestControlAsset", fields: [controlAssetId], references: [id], onDelete: Cascade)

  @@map("image_ab_tests")
}

model ContentABTest {
  id              String   @id @default(cuid())
  workspaceId     String
  testName        String
  description     String?
  
  // Test Configuration
  testType        ABTestType       @default(CONTENT)
  platform        SocialProvider?
  startDate       DateTime
  endDate         DateTime?
  status          ABTestStatus     @default(DRAFT)
  sampleSize      Int?             // Minimum audience size for statistical significance
  confidenceLevel Float            @default(0.95) // Statistical confidence threshold
  
  // Control Content
  controlTitle    String?
  controlContent  String
  controlHashtags String[]
  controlMediaIds String[]         // Asset IDs for control version
  
  // Variants
  variants        Json             // Array of variant content objects
  
  // Test Parameters
  trafficSplit    Json             // Traffic allocation per variant (e.g., {"control": 50, "variant1": 50})
  testDuration    Int?             // Test duration in hours
  autoOptimize    Boolean          @default(false) // Auto-select winning variant
  
  // Results & Metrics
  totalViews      Int              @default(0)
  controlMetrics  Json?            // Engagement metrics for control
  variantMetrics  Json?            // Engagement metrics for all variants
  winningVariant  String?          // "control" or variant key
  statisticalSignificance Float?   // P-value or confidence score
  liftPercentage  Float?           // Performance improvement %
  
  // AI-Powered Insights
  aiRecommendations Json?          // AI analysis of results
  nextTestSuggestions Json?        // Follow-up test recommendations
  audienceSegments Json?           // Segment-based performance analysis
  optimizationInsights Json?       // Content optimization suggestions
  
  // Automation
  autoPublish     Boolean          @default(false)  // Auto-publish winning variant
  publishedAt     DateTime?        // When winning variant was published
  scheduledFor    DateTime?        // Scheduled publish time for winner
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  // Relations
  workspace       Workspace        @relation("WorkspaceContentABTests", fields: [workspaceId], references: [id], onDelete: Cascade)
  executionLogs   ABTestExecution[] @relation("ABTestExecutions")

  @@map("content_ab_tests")
}

model ABTestExecution {
  id            String       @id @default(cuid())
  abTestId      String
  variant       String       // "control" or variant key
  userId        String?      // User who saw this variant
  sessionId     String?      // Session identifier
  
  // Interaction Data
  viewed        Boolean      @default(false)
  clicked       Boolean      @default(false)
  engaged       Boolean      @default(false)  // Liked, commented, shared
  converted     Boolean      @default(false)  // Achieved goal action
  
  // Metrics
  engagementScore Float?     // Calculated engagement score
  timeSpent     Int?         // Time spent viewing (seconds)
  interactions  Json?        // Detailed interaction data
  
  // Context
  platform      SocialProvider?
  deviceType    String?      // mobile, desktop, tablet
  location      String?      // Geographic location
  timestamp     DateTime     @default(now())
  
  // Relations
  abTest        ContentABTest @relation("ABTestExecutions", fields: [abTestId], references: [id], onDelete: Cascade)
  
  @@map("ab_test_executions")
}

// ========================================
// AUDIENCE INTELLIGENCE & SENTIMENT ANALYSIS
// ========================================

model SentimentAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  postId          String?
  sourceType      SentimentSource // comment, mention, dm, review
  sourceId        String   // Original comment/mention ID
  content         String   // Text content being analyzed
  
  // Sentiment Scores
  overallScore    Float    // -1 to 1 (negative to positive)
  positiveScore   Float    // 0 to 1
  negativeScore   Float    // 0 to 1
  neutralScore    Float    // 0 to 1
  confidenceScore Float    // 0 to 1
  
  // Emotion Analysis
  emotions        Json?    // {joy: 0.8, anger: 0.1, fear: 0.1}
  
  // Context
  platform        SocialProvider
  authorId        String?  // Social platform user ID
  authorHandle    String?  // @username
  
  // Metadata
  language        String?
  detectedTopics  String[] // Keywords/topics detected
  isInfluencer    Boolean @default(false)
  followerCount   Int?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceSentimentAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)
  post        Post?     @relation("PostSentimentAnalysis", fields: [postId], references: [id], onDelete: Cascade)

  @@index([workspaceId, createdAt])
  @@index([postId, overallScore])
  @@index([platform, createdAt])
  @@map("sentiment_analysis")
}

model SentimentTrend {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Time Period
  date            DateTime // Daily aggregation
  platform        SocialProvider?
  
  // Aggregated Metrics
  totalMentions   Int      @default(0)
  avgSentiment    Float    // Average sentiment score
  positiveCount   Int      @default(0)
  negativeCount   Int      @default(0)
  neutralCount    Int      @default(0)
  
  // Trend Analysis
  sentimentChange Float?   // Change from previous period
  volumeChange    Float?   // Change in mention volume
  
  // Top Topics/Keywords
  topPositiveTopics String[]
  topNegativeTopics String[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceSentimentTrends", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, date, platform])
  @@map("sentiment_trends")
}

model CrisisAlert {
  id              String      @id @default(cuid())
  workspaceId     String
  
  // Alert Details
  alertType       CrisisType
  severity        AlertSeverity
  title           String
  description     String
  
  // Trigger Data
  triggerMetric   String      // sentiment_spike, volume_surge, negative_trend
  currentValue    Float
  thresholdValue  Float
  timeframe       String      // 1h, 6h, 24h
  
  // Context
  platform        SocialProvider?
  affectedPosts   String[]    // Post IDs
  keyMentions     String[]    // Critical mention IDs
  
  // Status
  status          AlertStatus @default(ACTIVE)
  acknowledgedBy  String?     // User ID who acknowledged
  acknowledgedAt  DateTime?
  resolvedAt      DateTime?
  
  // Escalation
  notificationsSent Json?     // {email: true, slack: false, sms: true}
  escalationLevel   Int       @default(1)
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceCrisisAlerts", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, createdAt])
  @@index([severity, createdAt])
  @@map("crisis_alerts")
}

model AudienceSegment {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Segment Details
  name            String
  description     String?
  
  // Segmentation Criteria
  segmentType     SegmentType // behavioral, demographic, psychographic, platform
  criteria        Json        // Flexible criteria object
  
  // Size & Metrics
  estimatedSize   Int      @default(0)
  actualSize      Int      @default(0)
  
  // Engagement Patterns
  avgEngagementRate Float?
  preferredPlatforms SocialProvider[]
  activeHours     Json?    // [{hour: 9, score: 0.8}]
  topContentTypes String[] // image, video, text, link
  
  // AI Insights
  personalityTraits Json?  // {openness: 0.7, conscientiousness: 0.5}
  interests         String[]
  demographicProfile Json? // {age_range: "25-34", location: "US"}
  
  // Performance
  conversionRate  Float?
  avgOrderValue   Float?
  lifetimeValue   Float?
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace           Workspace               @relation("WorkspaceAudienceSegments", fields: [workspaceId], references: [id], onDelete: Cascade)
  contentRecommendations ContentRecommendation[]
  postingRecommendations PostingTimeRecommendation[]

  @@index([workspaceId, isActive])
  @@map("audience_segments")
}

model ContentRecommendation {
  id              String   @id @default(cuid())
  workspaceId     String
  segmentId       String
  
  // Recommendation Details
  title           String
  description     String
  recommendationType RecommendationType
  
  // Content Suggestions
  suggestedTopics String[]
  suggestedTone   ContentTone?
  suggestedFormats String[]  // image, video, carousel, story
  suggestedHashtags String[]
  
  // Platform Optimization
  platforms       SocialProvider[]
  
  // Performance Prediction
  predictedEngagement Float?
  predictedReach      Int?
  confidenceScore     Float?
  
  // Status
  status          RecommendationStatus @default(PENDING)
  usedAt          DateTime?
  resultPostId    String?
  actualPerformance Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace       @relation("WorkspaceContentRecommendations", fields: [workspaceId], references: [id], onDelete: Cascade)
  segment   AudienceSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status])
  @@index([segmentId, createdAt])
  @@map("content_recommendations")
}

model PostingTimeRecommendation {
  id              String   @id @default(cuid())
  workspaceId     String
  segmentId       String
  
  // Time Recommendations
  platform        SocialProvider
  dayOfWeek       Int      // 0-6 (Sunday-Saturday)
  hour            Int      // 0-23
  timezone        String   // UTC offset or timezone name
  
  // Confidence & Performance
  confidenceScore Float    // 0-1
  expectedEngagement Float // Predicted engagement rate
  audienceSize    Int      // Expected audience size at this time
  
  // Supporting Data
  historicalData  Json?    // Historical performance data
  competitorData  Json?    // Competitor posting patterns
  
  // Metadata
  dataPoints      Int      // Number of posts used for analysis
  lastUpdated     DateTime @default(now())
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace       @relation("WorkspacePostingRecommendations", fields: [workspaceId], references: [id], onDelete: Cascade)
  segment   AudienceSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([segmentId, platform, dayOfWeek, hour])
  @@index([workspaceId, platform])
  @@map("posting_time_recommendations")
}

model EngagementPattern {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Pattern Identification
  patternType     EngagementPatternType
  patternName     String
  description     String
  
  // Pattern Data
  triggers        Json     // What triggers this pattern
  behaviors       Json     // Behavioral characteristics
  timeline        Json     // When this pattern occurs
  
  // Audience Characteristics
  audienceSize    Int      @default(0)
  demographics    Json?    // Age, location, interests
  platforms       SocialProvider[]
  
  // Performance Metrics
  avgEngagementRate Float?
  avgReach         Int?
  conversionRate   Float?
  
  // Confidence & Validity
  confidenceScore Float    // Statistical confidence
  dataPoints      Int      // Number of observations
  
  // Insights
  insights        Json?    // AI-generated insights
  actionableItems Json?    // Recommended actions
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceEngagementPatterns", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, patternType])
  @@index([isActive, createdAt])
  @@map("engagement_patterns")
}

// Relations added to existing models:
// - Workspace: Added audience intelligence relations
// - Post: Added sentiment analysis relation

// ========================================
// AUDIENCE INTELLIGENCE ENUMS
// ========================================

enum SentimentSource {
  COMMENT
  MENTION
  DIRECT_MESSAGE
  REVIEW
  SHARE
  REPLY
}

enum CrisisType {
  SENTIMENT_SPIKE
  VOLUME_SURGE
  NEGATIVE_TREND
  BRAND_ATTACK
  PR_CRISIS
  VIRAL_NEGATIVE
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertStatus {
  ACTIVE
  ACKNOWLEDGED
  INVESTIGATING
  RESOLVED
  FALSE_POSITIVE
}

enum SegmentType {
  BEHAVIORAL
  DEMOGRAPHIC
  PSYCHOGRAPHIC
  PLATFORM
  ENGAGEMENT
  LIFECYCLE
}

enum RecommendationType {
  CONTENT_TOPIC
  CONTENT_FORMAT
  POSTING_TIME
  HASHTAG
  TONE
  PLATFORM
}

enum RecommendationStatus {
  PENDING
  ACCEPTED
  REJECTED
  IMPLEMENTED
  TESTING
}

enum EngagementPatternType {
  SEASONAL
  WEEKLY
  DAILY
  EVENT_BASED
  CONTENT_TYPE
  PLATFORM_SPECIFIC
  DEMOGRAPHIC
}

// ========================================
// ADVANCED AUTOMATION & INTELLIGENCE
// ========================================

model TrendAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Source Information
  sourceType      TrendSource // news, social, viral, competitor
  sourceUrl       String?
  sourceTitle     String
  sourceContent   String?
  
  // Trend Data
  trendScore      Float    // 0-1 relevance score
  viralityScore   Float?   // 0-1 virality potential
  industryMatch   Float    // 0-1 industry relevance
  
  // Content Suggestions
  suggestedTopics String[]
  suggestedAngles String[]
  suggestedFormats String[] // video, image, text, poll
  
  // Metadata
  tags            String[]
  category        String
  language        String   @default("en")
  detectedAt      DateTime @default(now())
  expiresAt       DateTime? // When trend becomes outdated
  
  // AI Analysis
  aiAnalysis      Json?    // Detailed AI insights
  opportunityScore Float?  // 0-1 content opportunity score
  
  // Status
  status          TrendStatus @default(ACTIVE)
  usedInContent   Boolean     @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceTrendAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)
  contentSuggestions ContentSuggestion[]

  @@index([workspaceId, status, detectedAt])
  @@index([trendScore, viralityScore])
  @@map("trend_analysis")
}

model ContentGapAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Analysis Period
  analysisStartDate DateTime
  analysisEndDate   DateTime
  
  // Gap Identification
  missingTopics   String[]
  underperformingTopics String[]
  competitorTopics String[] // Topics competitors cover but we don't
  
  // Recommendations
  priorityTopics  Json     // [{topic, priority, reasoning}]
  suggestedContent Json    // [{topic, contentType, reasoning}]
  contentCalendarGaps Json // [{date, gap, opportunity}]
  
  // Competitive Analysis
  competitorAdvantages String[]
  differentiationOpportunities String[]
  
  // Performance Predictions
  expectedImpact  Json?    // Predicted performance if gaps are filled
  confidenceScore Float    // 0-1 confidence in recommendations
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceContentGapAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, analysisEndDate])
  @@map("content_gap_analysis")
}

model CompetitorAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Competitor Information
  competitorName  String
  competitorHandle String?
  platforms       SocialProvider[]
  
  // Content Analysis
  contentThemes   String[]
  postingFrequency Float    // Posts per day
  avgEngagement   Float
  topPerformingTypes String[]
  
  // Strategy Insights
  contentStrategy Json     // Detailed strategy analysis
  strengthsWeaknesses Json // {strengths: [], weaknesses: []}
  
  // Differentiation Opportunities
  differentiationStrategies Json // Specific strategies to stand out
  contentGaps     String[] // What they're missing
  overlapAreas    String[] // Where we compete directly
  
  // Performance Comparison
  performanceMetrics Json  // Comparison metrics
  benchmarkData   Json?    // Historical performance data
  
  // Update Tracking
  lastAnalyzedAt  DateTime @default(now())
  analysisVersion Int      @default(1)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceCompetitorAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, competitorName])
  @@index([workspaceId, lastAnalyzedAt])
  @@map("competitor_analysis")
}

model ContentSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  trendAnalysisId String?
  
  // Suggestion Details
  title           String
  description     String
  suggestedContent String?
  
  // Content Properties
  contentType     ContentType
  platforms       SocialProvider[]
  topics          String[]
  hashtags        String[]
  
  // AI-Generated Elements
  aiGeneratedCaption String?
  suggestedMedia  Json?    // Media suggestions/requirements
  callToAction    String?
  
  // Performance Prediction
  predictedEngagement Float?
  predictedReach     Int?
  viralPotential     Float?  // 0-1 score
  
  // Scheduling
  suggestedPostTime DateTime?
  timeZone         String?
  
  // Status & Tracking
  status          SuggestionStatus @default(PENDING)
  priority        Int              @default(3) // 1-5 priority
  implementedAt   DateTime?
  resultPostId    String?
  actualPerformance Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace      @relation("WorkspaceContentSuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)
  trendAnalysis   TrendAnalysis? @relation(fields: [trendAnalysisId], references: [id], onDelete: SetNull)

  @@index([workspaceId, status, priority])
  @@index([suggestedPostTime])
  @@map("content_suggestions")
}

model SmartResponse {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Context Information
  sourceType      ResponseSource // comment, dm, mention, review
  sourceId        String         // Original message ID
  sourcePlatform  SocialProvider
  originalMessage String
  
  // Response Generation
  suggestedResponse String
  responseType    ResponseType   // answer, acknowledge, escalate, custom
  tone           ResponseTone    // friendly, professional, casual, empathetic
  
  // Context Analysis
  sentiment      Float?          // Sentiment of original message
  intent         String?         // Detected user intent
  category       String?         // Support, complaint, compliment, question
  urgency        ResponseUrgency // low, medium, high, critical
  
  // AI Confidence & Metadata
  confidenceScore Float          // 0-1 confidence in response
  languageDetected String        // Detected language
  requiresHuman   Boolean        @default(false)
  
  // Status & Usage
  status         ResponseStatus  @default(PENDING)
  usedAt         DateTime?
  feedback       String?         // Human feedback on response quality
  rating         Int?            // 1-5 rating of response quality
  
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  // Relations
  workspace      Workspace       @relation("WorkspaceSmartResponses", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, urgency])
  @@index([sourcePlatform, responseType])
  @@map("smart_responses")
}

model ResponseTemplate {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Template Information
  category        String           // greeting, support, faq, etc.
  keywords        String[]         // Keywords that trigger this template
  template        String           // Template text with variables
  tone            ResponseTone
  platform        SocialProvider?
  language        String           @default("en")
  
  // Usage Statistics
  usageCount      Int              @default(0)
  lastUsed        DateTime?
  
  // Meta Information
  isActive        Boolean          @default(true)
  createdBy       String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  workspace       Workspace        @relation("WorkspaceResponseTemplates", fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@index([workspaceId, category, isActive])
  @@index([keywords])
  @@map("response_templates")
}

model AutomationRule {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Rule Definition
  name            String
  description     String?
  ruleType        AutomationType
  
  // Trigger Conditions
  triggers        Json     // Complex trigger conditions
  conditions      Json     // Additional conditions to check
  
  // Actions
  actions         Json     // Actions to perform when triggered
  
  // Settings
  isActive        Boolean  @default(true)
  priority        Int      @default(3) // 1-5 priority
  
  // Execution Tracking
  executionCount  Int      @default(0)
  successCount    Int      @default(0)
  lastExecutedAt  DateTime?
  lastError       String?
  
  // Rate Limiting
  maxExecutionsPerHour Int? @default(10)
  maxExecutionsPerDay  Int? @default(100)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace         @relation("WorkspaceAutomationRules", fields: [workspaceId], references: [id], onDelete: Cascade)
  executions      AutomationExecution[]

  @@index([workspaceId, isActive, ruleType])
  @@map("automation_rules")
}

model AutomationExecution {
  id              String   @id @default(cuid())
  ruleId          String
  workspaceId     String
  
  // Execution Details
  triggeredBy     String?  // What triggered this execution
  triggerData     Json?    // Data that triggered the execution
  
  // Execution Results
  status          ExecutionStatus
  executedActions Json?    // Actions that were executed
  results         Json?    // Results of the execution
  
  // Error Handling
  errorMessage    String?
  retryCount      Int      @default(0)
  maxRetries      Int      @default(3)
  
  // Timing
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  duration        Int?     // Execution time in milliseconds
  
  createdAt       DateTime @default(now())

  // Relations
  rule            AutomationRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)
  workspace       Workspace      @relation("WorkspaceAutomationExecutions", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([ruleId, status])
  @@index([workspaceId, startedAt])
  @@map("automation_executions")
}

model ContentCalendarOptimization {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Optimization Period
  startDate       DateTime
  endDate         DateTime
  
  // Current State Analysis
  currentSchedule Json     // Current posting schedule analysis
  performanceGaps Json     // Identified performance gaps
  
  // AI Recommendations
  optimizedSchedule Json   // AI-optimized posting schedule
  improvementPredictions Json // Expected improvements
  
  // Implementation
  suggestedChanges Json    // Specific changes to make
  implementationPlan Json  // Step-by-step implementation
  
  // Performance Tracking
  baselineMetrics Json?    // Performance before optimization
  projectedMetrics Json?   // Projected performance after
  actualResults   Json?    // Actual results after implementation
  
  // Status
  status          OptimizationStatus @default(PENDING)
  implementedAt   DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceCalendarOptimizations", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, startDate])
  @@map("content_calendar_optimizations")
}

model Translation {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Content Information
  originalContent String
  originalLanguage String
  targetLanguage  String
  contentType     String   // post, comment, dm, etc.
  
  // Translation
  translatedContent String
  translationService String // openai, google, azure
  
  // Quality & Confidence
  confidenceScore Float    // 0-1 translation confidence
  qualityScore    Float?   // 0-1 human-rated quality
  
  // Context & Metadata
  context         Json?    // Additional context for translation
  culturalAdaptation Boolean @default(false) // Whether cultural adaptation was applied
  
  // Usage Tracking
  usageCount      Int      @default(0)
  lastUsedAt      DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceTranslations", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, originalContent, targetLanguage])
  @@index([originalLanguage, targetLanguage])
  @@map("translations")
}


// ========================================
// ADVANCED AUTOMATION ENUMS
// ========================================

enum TrendSource {
  NEWS
  SOCIAL
  VIRAL
  COMPETITOR
  INDUSTRY
  HASHTAG
}

enum TrendStatus {
  ACTIVE
  DECLINING
  EXPIRED
  USED
}

enum ContentType {
  TEXT
  IMAGE
  VIDEO
  CAROUSEL
  STORY
  REEL
  POLL
  LIVE
  THREAD
}

enum SuggestionStatus {
  PENDING
  APPROVED
  REJECTED
  IMPLEMENTED
  EXPIRED
}

enum ResponseSource {
  COMMENT
  DM
  MENTION
  REVIEW
  CHAT
}

enum ResponseType {
  ANSWER
  ACKNOWLEDGE
  ESCALATE
  CUSTOM
  AUTO_RESOLVE
}

enum ResponseTone {
  FRIENDLY
  PROFESSIONAL
  CASUAL
  EMPATHETIC
  FORMAL
  HUMOROUS
}

enum ResponseUrgency {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ResponseStatus {
  PENDING
  APPROVED
  REJECTED
  SENT
  FAILED
}

enum AutomationType {
  CONTENT_SUGGESTION
  SMART_RESPONSE
  CRISIS_MANAGEMENT
  ENGAGEMENT_FOLLOW_UP
  SCHEDULING_OPTIMIZATION
  TREND_MONITORING
  COMPETITOR_TRACKING
}

enum ExecutionStatus {
  PENDING
  RUNNING
  SUCCESS
  FAILED
  CANCELLED
  RETRY
}

enum OptimizationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

// ========================================
// VISUAL ANALYTICS ENUMS
// ========================================

enum ABTestStatus {
  DRAFT
  RUNNING
  COMPLETED
  PAUSED
  CANCELLED
}

enum ABTestType {
  CONTENT      // Content/copy testing
  TIMING       // Posting time optimization
  HASHTAGS     // Hashtag strategy testing
  VISUAL       // Image/video testing
  AUDIENCE     // Audience targeting testing
  HYBRID       // Multiple element testing
}

// ========================================
// INTERNATIONALIZATION MODELS
// ========================================

model TranslationCache {
  id               String    @id @default(cuid())
  sourceText       String
  sourceLanguage   String    @default("en")
  targetLanguage   String
  translatedText   String
  context          String?
  workspaceId      String?
  quality          Decimal?  @default(0.95)
  usageCount       Int       @default(1)
  expiresAt        DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  workspace Workspace? @relation("WorkspaceTranslationCache", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([sourceText, targetLanguage])
  @@index([workspaceId])
  @@index([expiresAt])
  @@map("translation_cache")
}

model UserLanguagePreference {
  id           String   @id @default(cuid())
  userId       String
  locale       String
  isDefault    Boolean  @default(false)
  proficiency  String   @default("native") // native, fluent, intermediate, basic
  autoTranslate Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation("UserLanguagePreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, locale])
  @@index([userId])
  @@index([locale])
  @@map("user_language_preferences")
}

model WorkspaceContentTranslation {
  id                 String   @id @default(cuid())
  workspaceId        String
  contentType        String   // post_template, campaign_name, etc.
  contentId          String
  locale             String
  translatedContent  Json
  isHumanTranslated  Boolean  @default(false)
  translatedBy       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  workspace    Workspace @relation("WorkspaceContentTranslations", fields: [workspaceId], references: [id], onDelete: Cascade)
  translatedByUser User?     @relation("ContentTranslatedBy", fields: [translatedBy], references: [id], onDelete: SetNull)

  @@unique([contentId, locale])
  @@index([workspaceId, contentType])
  @@index([contentId, locale])
  @@map("workspace_content_translations")
}

model CustomDashboard {
  id          String   @id @default(cuid())
  userId      String
  workspaceId String
  name        String   @default("My Dashboard")
  description String?
  isDefault   Boolean  @default(false)
  
  // Dashboard Layout & Configuration
  layout      Json     // Grid layout configuration
  widgets     Json     // Widget configurations array
  settings    Json?    // Dashboard-wide settings (colors, refresh rate, etc.)
  
  // Metadata
  isPublic    Boolean  @default(false)
  tags        String[] @default([])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User      @relation("UserCustomDashboards", fields: [userId], references: [id], onDelete: Cascade)
  workspace   Workspace @relation("WorkspaceCustomDashboards", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId, name])
  @@index([userId, workspaceId])
  @@index([workspaceId, isPublic])
  @@map("custom_dashboards")
}
