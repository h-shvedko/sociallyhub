// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// CORE ENTITIES
// ========================================

model Workspace {
  id               String   @id @default(cuid())
  name             String
  timezone         String   @default("UTC")
  branding         Json?    // Store workspace branding (logo, colors, etc.)
  defaultLocale    String   @default("en")
  supportedLocales String[] @default(["en"])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  users          UserWorkspace[]
  clients        Client[]
  invoices       Invoice[]
  socialAccounts SocialAccount[]
  posts          Post[]
  campaigns      Campaign[]
  campaignReports CampaignReport[]
  assets         Asset[]
  templates      Template[]
  inboxItems     InboxItem[]
  auditEvents    AuditEvent[]
  analytics      AnalyticsMetric[] @relation("WorkspaceAnalytics")
  
  // AI Relations
  aiSuggestions     AIContentSuggestion[] @relation("WorkspaceAISuggestions")
  aiUsage           AIUsageTracking[]     @relation("WorkspaceAIUsage")
  hashtagSuggestions HashtagSuggestion[]  @relation("WorkspaceHashtagSuggestions")
  
  // Visual Analytics Relations
  imageAnalysis     ImageAnalysis[]       @relation("WorkspaceImageAnalysis")
  imageOptimizations ImageOptimization[]  @relation("WorkspaceImageOptimization")
  visualMetrics     VisualPerformanceMetric[] @relation("WorkspaceVisualMetrics")
  brandGuidelines   BrandVisualGuideline[] @relation("WorkspaceBrandGuidelines")
  imageABTests      ImageABTest[]         @relation("WorkspaceImageABTests")
  
  // Audience Intelligence Relations
  sentimentAnalysis     SentimentAnalysis[]        @relation("WorkspaceSentimentAnalysis")
  sentimentTrends       SentimentTrend[]           @relation("WorkspaceSentimentTrends")
  crisisAlerts          CrisisAlert[]              @relation("WorkspaceCrisisAlerts")
  audienceSegments      AudienceSegment[]          @relation("WorkspaceAudienceSegments")
  contentRecommendations ContentRecommendation[]   @relation("WorkspaceContentRecommendations")
  postingRecommendations PostingTimeRecommendation[] @relation("WorkspacePostingRecommendations")
  engagementPatterns    EngagementPattern[]        @relation("WorkspaceEngagementPatterns")
  
  // Advanced Automation Relations
  trendAnalysis         TrendAnalysis[]             @relation("WorkspaceTrendAnalysis")
  contentGapAnalysis    ContentGapAnalysis[]        @relation("WorkspaceContentGapAnalysis")
  competitorAnalysis    CompetitorAnalysis[]        @relation("WorkspaceCompetitorAnalysis")
  contentSuggestions    ContentSuggestion[]         @relation("WorkspaceContentSuggestions")
  smartResponses        SmartResponse[]             @relation("WorkspaceSmartResponses")
  automationRules       AutomationRule[]            @relation("WorkspaceAutomationRules")
  automationExecutions  AutomationExecution[]       @relation("WorkspaceAutomationExecutions")
  calendarOptimizations ContentCalendarOptimization[] @relation("WorkspaceCalendarOptimizations")
  translations          Translation[]               @relation("WorkspaceTranslations")
  responseTemplates     ResponseTemplate[]          @relation("WorkspaceResponseTemplates")
  
  // A/B Testing Relations
  contentABTests        ContentABTest[]             @relation("WorkspaceContentABTests")
  
  // Translation Relations
  translationCache      TranslationCache[]          @relation("WorkspaceTranslationCache")
  contentTranslations   WorkspaceContentTranslation[] @relation("WorkspaceContentTranslations")
  
  // Custom Dashboard Relations
  customDashboards      CustomDashboard[] @relation("WorkspaceCustomDashboards")
  budgetSettings        BudgetSettings? @relation("WorkspaceBudgetSettings")
  
  // Client Reporting Relations
  clientReports         ClientReport[]
  clientReportTemplates ClientReportTemplate[]
  clientReportSchedules ClientReportSchedule[]
  
  // Team Invitation Relations
  teamInvitations       TeamInvitation[] @relation("WorkspaceInvitations")
  
  // Branding & Customization Relations
  clientBranding        ClientBranding? @relation("WorkspaceClientBranding")
  landingPageConfig     LandingPageConfig? @relation("WorkspaceLandingPage")

  // Platform Credentials Relations
  platformCredentials   PlatformCredentials[] @relation("WorkspacePlatformCredentials")

  // Support Chat Relations
  supportChats          SupportChat[] @relation("SupportChatWorkspace")
  contactForms          SupportContactForm[] @relation("ContactFormWorkspace")
  supportTickets        SupportTicket[] @relation("TicketWorkspace")

  // Community Relations
  forumPosts            CommunityForumPost[] @relation("ForumPostWorkspace")
  featureRequests       FeatureRequest[] @relation("FeatureRequestWorkspace")
  discordIntegration    DiscordIntegration? @relation("DiscordWorkspace")
  communityActivities   CommunityActivity[] @relation("CommunityActivityWorkspace")

  // Moderation Relations
  moderationActions     ModerationAction[] @relation("WorkspaceModerationActions")
  userModerationHistory UserModerationHistory[] @relation("WorkspaceUserModerationHistory")
  contentReports        ContentReport[] @relation("WorkspaceContentReports")
  autoModerationRules   AutoModerationRule[] @relation("WorkspaceAutoModerationRules")
  spamDetections        SpamDetection[] @relation("WorkspaceSpamDetections")
  moderationQueue       ModerationQueue[] @relation("WorkspaceModerationQueue")
  communityAnalytics    CommunityAnalytics[] @relation("WorkspaceCommunityAnalytics")

  // User Role & Permission Management Relations
  teams                 Team[]
  userInvitations       UserInvitation[]
  userActivities        UserActivity[]
  auditLogs            AuditLog[]

  @@map("workspaces")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  emailVerified DateTime?
  name          String?
  image         String?
  password      String?
  twoFactorEnabled Boolean @default(false)
  timezone      String?  @default("UTC")
  locale        String?  @default("en")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  workspaces      UserWorkspace[]
  accounts        Account[]
  sessions        Session[]
  assignedInboxItems InboxItem[] @relation("AssignedTo")
  notifications   Notification[]
  auditEvents     AuditEvent[]
  createdPosts    Post[]
  approvedPosts   Post[] @relation("ApprovedBy")
  analytics       AnalyticsMetric[] @relation("UserAnalytics")
  userSessions    UserSession[] @relation("UserSessions")
  userActions     UserAction[] @relation("UserActions")
  
  // AI Relations
  aiSuggestions   AIContentSuggestion[] @relation("UserAISuggestions")
  
  // Translation Relations
  languagePreferences  UserLanguagePreference[] @relation("UserLanguagePreferences")
  translatedContent    WorkspaceContentTranslation[] @relation("ContentTranslatedBy")
  
  // Custom Dashboard Relations
  customDashboards     CustomDashboard[] @relation("UserCustomDashboards")
  aiUsage         AIUsageTracking[]     @relation("UserAIUsage")
  
  // Team Invitation Relations
  sentInvitations      TeamInvitation[] @relation("InvitationSender")
  
  // Settings Relations
  settings             UserSettings? @relation("UserSettingsRelation")
  notificationPreferences NotificationPreferences? @relation("UserNotificationPreferences")

  // Help Center Relations
  helpArticles         HelpArticle[] @relation("HelpArticleAuthor")
  helpArticleComments  HelpArticleComment[] @relation("HelpArticleCommentAuthor")
  helpArticleBookmarks HelpArticleBookmark[] @relation("UserBookmarks")
  helpArticleRevisions HelpArticleRevision[] @relation("HelpArticleRevisionAuthor")
  helpArticleTemplates HelpArticleTemplate[] @relation("HelpArticleTemplateAuthor")
  workflowsRequested   HelpArticleWorkflow[] @relation("WorkflowRequestedBy")
  workflowsAssigned    HelpArticleWorkflow[] @relation("WorkflowAssignedTo")
  workflowsReviewed    HelpArticleWorkflow[] @relation("WorkflowReviewedBy")

  // Documentation Relations
  documentationPages       DocumentationPage[] @relation("DocumentationAuthor")
  documentationVersions    DocumentationVersion[] @relation("DocumentationVersionAuthor")
  documentationCodeExamples DocumentationCodeExample[] @relation("DocumentationCodeExampleAuthor")
  documentationComments    DocumentationComment[] @relation("DocumentationCommentAuthor")
  documentationCollaborations DocumentationCollaborator[] @relation("DocumentationCollaboratorUser")
  documentationRevisions   DocumentationRevision[] @relation("DocumentationRevisionAuthor")
  documentationWorkflowsRequested DocumentationWorkflow[] @relation("DocumentationWorkflowRequestedBy")
  documentationWorkflowsAssigned  DocumentationWorkflow[] @relation("DocumentationWorkflowAssignedTo")
  documentationWorkflowsReviewed  DocumentationWorkflow[] @relation("DocumentationWorkflowReviewedBy")
  documentationExports     DocumentationExport[] @relation("DocumentationExportCreatedBy")

  // Support Chat Relations
  supportAgent         SupportAgent? @relation("SupportAgentUser")
  supportChats         SupportChat[] @relation("SupportChatUser")
  contactForms         SupportContactForm[] @relation("ContactFormUser")
  supportTickets       SupportTicket[] @relation("TicketUser")

  // Community Relations
  forumPosts           CommunityForumPost[] @relation("ForumPostUser")
  forumReplies         CommunityForumReply[] @relation("ForumReplyUser")
  forumVotes           CommunityForumVote[] @relation("ForumVoteUser")
  featureRequests      FeatureRequest[] @relation("FeatureRequestUser")
  featureVotes         FeatureRequestVote[] @relation("FeatureVoteUser")
  featureComments      FeatureRequestComment[] @relation("FeatureCommentUser")
  communityActivities  CommunityActivity[] @relation("CommunityActivityUser")

  // Video Tutorial Relations
  videoProgress        VideoUserProgress[]

  // Moderation Relations
  moderatorActions     ModerationAction[] @relation("ModeratorActions")
  reviewerActions      ModerationAction[] @relation("ReviewerActions")
  moderationHistory    UserModerationHistory[] @relation("UserModerationHistory")
  submittedReports     ContentReport[] @relation("ReportSubmitter")
  reportedContent      ContentReport[] @relation("ReportedUser")

  // User Role & Permission Management Relations
  userRoles            UserRole[]
  assignedRoles        UserRole[] @relation("UserRoleAssignments")
  teamMemberships      TeamMember[]
  userSessions         UserSession[]
  userActivities       UserActivity[]
  auditLogs           AuditLog[]
  sentUserInvitations  UserInvitation[] @relation("SentInvitations")
  ssoAccounts         SSOAccount[]

  @@map("users")
}

model UserWorkspace {
  id          String      @id @default(cuid())
  userId      String
  workspaceId String
  role        WorkspaceRole
  permissions Json        // Store granular permissions
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId])
  @@map("user_workspaces")
}

model TeamInvitation {
  id          String          @id @default(cuid())
  email       String
  role        WorkspaceRole
  token       String          @unique @default(cuid())
  status      InvitationStatus @default(PENDING)
  workspaceId String
  invitedById String
  createdAt   DateTime        @default(now())
  expiresAt   DateTime
  respondedAt DateTime?

  workspace   Workspace @relation("WorkspaceInvitations", fields: [workspaceId], references: [id], onDelete: Cascade)
  invitedBy   User      @relation("InvitationSender", fields: [invitedById], references: [id], onDelete: Cascade)

  @@map("team_invitations")
}

model Client {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  email       String
  phone       String?
  company     String?
  industry    String?
  website     String?
  logo        String?
  status      String   @default("ACTIVE")
  notes       String?
  labels      String[] // Tags for client organization
  billingInfo Json?    // Billing and contract information
  settings    Json?    // Client-specific settings and preferences
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace      Workspace       @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccounts SocialAccount[]
  posts          Post[]
  campaigns      Campaign[]
  invoices       Invoice[]
  reports        ClientReport[]
  reportSchedules ClientReportSchedule[]
  branding       ClientBranding[] @relation("ClientBrandingRelation")

  @@map("clients")
}

model Invoice {
  id            String   @id @default(cuid())
  invoiceNumber String
  workspaceId   String
  clientId      String
  clientName    String
  clientEmail   String?
  issueDate     DateTime @default(now())
  dueDate       DateTime
  currency      String   @default("USD")
  lineItems     Json     // Array of line items with description, quantity, rate, amount
  subtotal      Float
  tax           Float    @default(0)
  discount      Float    @default(0)
  total         Float
  notes         String?
  terms         String?
  status        String   @default("draft") // draft, sent, paid, overdue, cancelled
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, invoiceNumber])
  @@map("invoices")
}

model SocialAccount {
  id           String              @id @default(cuid())
  workspaceId  String
  clientId     String?
  provider     SocialProvider
  accountType  String              // "page", "profile", "channel", etc.
  handle       String              // @username or page name
  displayName  String
  accountId    String              // Provider's account ID
  accessToken  String              // Encrypted
  refreshToken String?             // Encrypted
  tokenExpiry  DateTime?
  scopes       String[]            // What permissions we have
  status       SocialAccountStatus @default(ACTIVE)
  metadata     Json?               // Provider-specific data
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  workspace    Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)
  postVariants PostVariant[]
  inboxItems   InboxItem[]
  metrics      AnalyticsMetric[]

  @@unique([provider, accountId, workspaceId])
  @@map("social_accounts")
}

// ========================================
// CONTENT & PUBLISHING
// ========================================

model Post {
  id          String     @id @default(cuid())
  workspaceId String
  clientId    String?
  title       String?
  baseContent String?    // Master content before platform customization
  link        String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  campaignId  String?
  tags        String[]
  status      PostStatus @default(DRAFT)
  ownerId     String     // User who created the post
  approverId  String?    // User who approved (if approval required)
  scheduledAt DateTime?
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  workspace    Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)
  owner        User          @relation(fields: [ownerId], references: [id])
  approver     User?         @relation("ApprovedBy", fields: [approverId], references: [id])
  campaign     Campaign?     @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  variants     PostVariant[]
  assets       PostAsset[]
  metrics      AnalyticsMetric[]
  
  // AI Relations
  aiSuggestions          AIContentSuggestion[]       @relation("PostAISuggestions")
  performancePrediction  ContentPerformancePrediction? @relation("PostPerformancePrediction")
  toneAnalysis          ContentToneAnalysis?        @relation("PostToneAnalysis")
  
  // Visual Analytics Relations
  visualMetrics         VisualPerformanceMetric[]   @relation("PostVisualMetrics")
  
  // Audience Intelligence Relations
  sentimentAnalysis     SentimentAnalysis[]         @relation("PostSentimentAnalysis")

  @@map("posts")
}

model PostVariant {
  id              String         @id @default(cuid())
  postId          String
  socialAccountId String
  text            String?
  hashtags        String[]
  platformData    Json?          // Platform-specific fields (YouTube title, etc.)
  status          VariantStatus  @default(PENDING)
  providerPostId  String?        // ID from the social platform after publishing
  publishedAt     DateTime?
  failureReason   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  post          Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  @@unique([postId, socialAccountId])
  @@map("post_variants")
}

model PostAsset {
  id      String @id @default(cuid())
  postId  String
  assetId String

  post  Post  @relation(fields: [postId], references: [id], onDelete: Cascade)
  asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@unique([postId, assetId])
  @@map("post_assets")
}

model Asset {
  id           String    @id @default(cuid())
  workspaceId  String
  filename     String
  originalName String
  mimeType     String
  size         Int       // File size in bytes
  url          String    // Storage URL
  thumbnailUrl String?   // Thumbnail for videos/images
  width        Int?      // Image/video width
  height       Int?      // Image/video height
  duration     Float?    // Video duration in seconds
  metadata     Json?     // EXIF, transcoding status, etc.
  tags         String[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  workspace Workspace   @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  posts     PostAsset[]
  
  // Visual Analytics Relations
  imageAnalysis     ImageAnalysis?      @relation("AssetImageAnalysis")
  performanceMetrics VisualPerformanceMetric[] @relation("AssetPerformanceMetrics")
  originalOptimizations ImageOptimization[] @relation("OriginalAsset")
  optimizedVersions     ImageOptimization[] @relation("OptimizedAsset")
  abTestControl         ImageABTest[]       @relation("ABTestControlAsset")

  @@map("assets")
}

model Template {
  id          String          @id @default(cuid())
  workspaceId String
  name        String
  description String?
  content     String          // Template content with variables
  variables   String[]        // List of variables like ["product", "url"]
  platforms   SocialProvider[] @default([]) // Platforms this template is designed for
  tags        String[]        @default([]) // Tags for organization
  type        TemplateType    @default(POST)
  isGlobal    Boolean         @default(false) // Global vs personal templates
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("templates")
}

model Campaign {
  id          String   @id @default(cuid())
  workspaceId String
  clientId    String?
  name        String
  description String?
  status      String   @default("DRAFT") // DRAFT, SCHEDULED, ACTIVE, PAUSED, COMPLETED, CANCELLED
  type        String   @default("CUSTOM") // BRAND_AWARENESS, LEAD_GENERATION, ENGAGEMENT, etc.
  startDate   DateTime?
  endDate     DateTime?
  objectives  Json?    // Campaign goals and KPIs
  budget      Json?    // Budget configuration: {totalBudget: number, spentAmount: number, dailyBudget: number, currency: string}
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
  posts     Post[]

  @@map("campaigns")
}

model CampaignReport {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  description String?
  type        String   // PERFORMANCE, EXECUTIVE, DETAILED, AB_TEST, CUSTOM
  format      String   // PDF, EXCEL, CSV, HTML
  frequency   String   // ON_DEMAND, DAILY, WEEKLY, MONTHLY
  campaigns   Json     // Array of campaign IDs
  sections    Json     // Included report sections
  recipients  String?  // Email recipients
  status      String   @default("READY") // READY, GENERATING, COMPLETED, FAILED
  downloadUrl String?
  generatedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("campaign_reports")
}

// ========================================
// INBOX & CONVERSATIONS
// ========================================

model InboxItem {
  id               String         @id @default(cuid())
  workspaceId      String
  socialAccountId  String
  type             InboxItemType
  providerThreadId String?        // Thread ID from social platform
  providerItemId   String         // Comment/message ID from platform
  content          String
  authorName       String?
  authorHandle     String?
  authorAvatar     String?
  sentiment        String?        // "positive", "negative", "neutral"
  status           InboxStatus    @default(OPEN)
  assigneeId       String?        // Assigned team member
  tags             String[]
  internalNotes    String?
  slaBreachedAt    DateTime?      // When SLA was breached
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  workspace     Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
  assignee      User?         @relation("AssignedTo", fields: [assigneeId], references: [id], onDelete: SetNull)
  conversation  Conversation?

  @@unique([providerItemId, socialAccountId])
  @@map("inbox_items")
}

model Conversation {
  id          String @id @default(cuid())
  inboxItemId String @unique
  threadData  Json?  // Full conversation thread from platform

  inboxItem InboxItem @relation(fields: [inboxItemId], references: [id], onDelete: Cascade)

  @@map("conversations")
}

// ========================================
// ANALYTICS & METRICS
// ========================================

model AnalyticsMetric {
  id              String         @id @default(cuid())
  workspaceId     String?        // For workspace-level filtering  
  userId          String         // User-level analytics
  socialAccountId String?        // Account-specific metrics
  postId          String?        // Post-specific metrics
  date            DateTime       @db.Date
  hour            Int?           // Hour of day (0-23) for hourly metrics
  platform        SocialProvider?
  metricType      String         // "impressions", "reach", "likes", "comments", "page_view", "session", etc.
  value           Float
  dimensions      Json?          // Additional dimensions (campaign, post_type, etc.)
  metadata        Json?          // Additional metadata
  createdAt       DateTime       @default(now())

  user          User           @relation("UserAnalytics", fields: [userId], references: [id], onDelete: Cascade)
  workspace     Workspace?     @relation("WorkspaceAnalytics", fields: [workspaceId], references: [id], onDelete: Cascade)
  socialAccount SocialAccount? @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)
  post          Post?          @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, socialAccountId, postId, date, hour, metricType])
  @@index([workspaceId, date])
  @@index([userId, date])
  @@index([postId, metricType])
  @@map("analytics_metrics")
}

// User sessions for analytics
model UserSession {
  id           String    @id @default(cuid())
  userId       String
  startTime    DateTime
  endTime      DateTime?
  lastActivity DateTime
  duration     Int?      // Session duration in seconds
  userAgent    String?
  ip           String?
  pages        String[]  // Pages visited during session
  metadata     Json?     // Additional session data
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user User @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, startTime])
  @@index([lastActivity])
  @@map("user_sessions")
}

// User actions for detailed analytics
model UserAction {
  id         String   @id @default(cuid())
  userId     String
  actionType String   // "click", "view", "create", "update", "delete", etc.
  timestamp  DateTime
  details    Json?    // Action-specific details
  duration   Int?     // Time taken for action in milliseconds
  createdAt  DateTime @default(now())

  user User @relation("UserActions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([actionType, timestamp])
  @@map("user_actions")
}

// Alerts for monitoring system
model Alert {
  id          String    @id @default(cuid())
  ruleId      String    // ID of the alert rule that triggered this
  title       String
  description String
  severity    String    // "low", "medium", "high", "critical"
  timestamp   DateTime
  resolved    Boolean   @default(false)
  resolvedAt  DateTime?
  metadata    Json?     // Alert-specific data
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([resolved, timestamp])
  @@index([severity, timestamp])
  @@map("alerts")
}

// ========================================
// CLIENT REPORTING
// ========================================

model ClientReport {
  id          String   @id @default(cuid())
  workspaceId String
  clientId    String
  templateId  String?  // Reference to report template if used
  name        String
  description String?
  type        String   // EXECUTIVE, PERFORMANCE, ANALYTICS, CUSTOM
  format      String   // PDF, EXCEL, CSV, DASHBOARD_LINK
  frequency   String   // ON_DEMAND, DAILY, WEEKLY, MONTHLY, QUARTERLY
  status      String   @default("DRAFT") // DRAFT, SCHEDULED, GENERATING, COMPLETED, FAILED, SENT
  config      Json?    // Report configuration: metrics, date ranges, filters
  data        Json?    // Generated report data
  filePath    String?  // Path to generated file
  fileSize    String?  // File size for downloads
  recipients  String[] @default([]) // Email recipients
  lastGenerated DateTime?
  downloadCount Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  template  ClientReportTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)

  @@index([clientId, status])
  @@index([frequency, status])
  @@map("client_reports")
}

model ClientReportTemplate {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  description String?
  type        String   // EXECUTIVE, PERFORMANCE, ANALYTICS, CUSTOM
  format      String[] // PDF, EXCEL, CSV, DASHBOARD_LINK
  metrics     String[] // Metrics to include: followers, engagement, reach, etc.
  sections    Json     // Report sections and layout
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  customDashboard Boolean @default(false)
  autoEmail   Boolean  @default(false)
  emailTemplate String? // Email template for automated reports
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  reports   ClientReport[]
  schedules ClientReportSchedule[]

  @@map("client_report_templates")
}

model ClientReportSchedule {
  id          String   @id @default(cuid())
  workspaceId String
  clientId    String
  templateId  String
  name        String
  frequency   String   // DAILY, WEEKLY, MONTHLY, QUARTERLY
  dayOfWeek   Int?     // For weekly reports (0=Sunday, 1=Monday, etc.)
  dayOfMonth  Int?     // For monthly reports
  time        String   // Time to send (HH:MM format)
  recipients  String[] @default([])
  isActive    Boolean  @default(true)
  lastRun     DateTime?
  nextRun     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  template  ClientReportTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([isActive, nextRun])
  @@map("client_report_schedules")
}

// ========================================
// SYSTEM & NOTIFICATIONS
// ========================================

model Notification {
  id          String             @id @default(cuid())
  userId      String
  type        NotificationType
  title       String
  message     String
  data        Json?              // Additional notification data
  status      NotificationStatus @default(UNREAD)
  deliveredAt DateTime?
  readAt      DateTime?
  createdAt   DateTime           @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model AuditEvent {
  id          String   @id @default(cuid())
  workspaceId String
  userId      String?  // Can be null for system events
  action      String   // "create", "update", "delete", "publish", etc.
  resource    String   // "post", "account", "user", etc.
  resourceId  String?  // ID of the affected resource
  oldValues   Json?    // Previous state
  newValues   Json?    // New state
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([workspaceId, createdAt])
  @@index([userId, createdAt])
  @@map("audit_events")
}

// ========================================
// NEXT-AUTH MODELS
// ========================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ========================================
// ENUMS
// ========================================

enum WorkspaceRole {
  OWNER
  ADMIN
  PUBLISHER
  ANALYST
  CLIENT_VIEWER
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

enum SocialProvider {
  TWITTER
  FACEBOOK
  INSTAGRAM
  LINKEDIN
  YOUTUBE
  TIKTOK
  SYSTEM
}

enum SocialAccountStatus {
  ACTIVE
  TOKEN_EXPIRED
  REVOKED
  ERROR
}

enum PostStatus {
  DRAFT
  IN_REVIEW
  APPROVED
  SCHEDULED
  PUBLISHED
  FAILED
  CHANGES_REQUESTED
  ARCHIVED
}

enum VariantStatus {
  PENDING
  SCHEDULED
  PUBLISHED
  FAILED
}

enum InboxItemType {
  COMMENT
  MENTION
  DIRECT_MESSAGE
  REVIEW
  REPLY
}

enum InboxStatus {
  OPEN
  ASSIGNED
  SNOOZED
  CLOSED
}

enum TemplateType {
  POST
  RESPONSE
}

enum NotificationType {
  APPROVAL_REQUESTED
  APPROVAL_GRANTED
  APPROVAL_DENIED
  PUBLISH_SUCCESS
  PUBLISH_FAILED
  TOKEN_EXPIRING
  TOKEN_EXPIRED
  INBOX_ASSIGNMENT
  SLA_BREACH
  REPORT_READY
}

enum NotificationStatus {
  UNREAD
  READ
  DISMISSED
}

// ========================================
// AI FEATURES
// ========================================

model AIContentSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  userId          String
  originalContent String?
  suggestedContent String
  suggestionType  AISuggestionType
  platform        SocialProvider?
  confidenceScore Float?
  used            Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace @relation("WorkspaceAISuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User      @relation("UserAISuggestions", fields: [userId], references: [id], onDelete: Cascade)
  post      Post?     @relation("PostAISuggestions", fields: [postId], references: [id], onDelete: Cascade)
  postId    String?

  @@map("ai_content_suggestions")
}

model ContentPerformancePrediction {
  id                         String   @id @default(cuid())
  postId                     String   @unique
  predictedEngagementRate    Float?
  predictedReach             Int?
  predictedImpressions       Int?
  predictedLikes             Int?
  predictedComments          Int?
  predictedShares            Int?
  confidenceScore            Float?
  actualEngagementRate       Float?
  actualReach                Int?
  actualImpressions          Int?
  actualLikes                Int?
  actualComments             Int?
  actualShares               Int?
  predictionAccuracy         Float?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt

  // Relations
  post Post @relation("PostPerformancePrediction", fields: [postId], references: [id], onDelete: Cascade)

  @@map("content_performance_predictions")
}

model AIUsageTracking {
  id            String   @id @default(cuid())
  workspaceId   String
  userId        String
  featureType   AIFeatureType
  tokensUsed    Int?
  costCents     Int?
  responseTimeMs Int?
  model         String?
  successful    Boolean  @default(true)
  errorMessage  String?
  createdAt     DateTime @default(now())

  // Relations
  workspace Workspace @relation("WorkspaceAIUsage", fields: [workspaceId], references: [id], onDelete: Cascade)
  user      User      @relation("UserAIUsage", fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_usage_tracking")
}

model AIModelVersion {
  id          String   @id @default(cuid())
  name        String
  version     String
  provider    AIProvider
  isActive    Boolean  @default(true)
  configuration Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([name, version])
  @@map("ai_model_versions")
}

model HashtagSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  hashtag         String
  platform        SocialProvider
  trendingScore   Float?
  performanceScore Float?
  category        String?
  isBlocked       Boolean  @default(false)
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())

  // Relations
  workspace Workspace @relation("WorkspaceHashtagSuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, hashtag, platform])
  @@map("hashtag_suggestions")
}

model ContentToneAnalysis {
  id          String   @id @default(cuid())
  postId      String   @unique
  tone        ContentTone
  confidence  Float?
  sentiment   Float?    // -1 to 1 (negative to positive)
  formality   Float?    // 0 to 1 (informal to formal)
  energy      Float?    // 0 to 1 (low to high energy)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  post Post @relation("PostToneAnalysis", fields: [postId], references: [id], onDelete: Cascade)

  @@map("content_tone_analysis")
}

// ========================================
// AI ENUMS
// ========================================

enum AISuggestionType {
  HASHTAGS
  CAPTION
  TONE_ADJUSTMENT
  OPTIMIZATION
  TRANSLATION
}

enum AIFeatureType {
  CONTENT_GENERATION
  HASHTAG_SUGGESTION
  TONE_ANALYSIS
  PERFORMANCE_PREDICTION
  IMAGE_ANALYSIS
  TRANSLATION
}

enum AIProvider {
  OPENAI
  ANTHROPIC
  GOOGLE
  AZURE
}

enum ContentTone {
  PROFESSIONAL
  CASUAL
  HUMOROUS
  INSPIRATIONAL
  EDUCATIONAL
  PROMOTIONAL
  CONVERSATIONAL
  FORMAL
}

// ========================================
// VISUAL CONTENT ANALYTICS
// ========================================

model ImageAnalysis {
  id               String   @id @default(cuid())
  assetId          String   @unique
  workspaceId      String
  
  // Image Properties
  width            Int
  height           Int
  format           String
  fileSize         Int
  dominantColors   Json     // Array of hex colors
  colorPalette     Json     // Full color analysis
  
  // AI Analysis
  labels           Json     // Detected objects/concepts
  faces            Json     // Face detection results
  text             Json     // OCR results
  safeSearch       Json     // Safe search annotations
  landmarks        Json     // Landmark detection
  
  // Brand Analysis
  brandScore       Float?   // Brand consistency score (0-1)
  logoDetected     Boolean  @default(false)
  brandColors      Json?    // Detected brand colors
  fontAnalysis     Json?    // Text overlay analysis
  
  // Performance Metrics
  aestheticScore   Float?   // Aesthetic quality score (0-1)
  compositonScore  Float?   // Composition analysis score (0-1)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  asset       Asset     @relation("AssetImageAnalysis", fields: [assetId], references: [id], onDelete: Cascade)
  workspace   Workspace @relation("WorkspaceImageAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("image_analysis")
}

model ImageOptimization {
  id               String   @id @default(cuid())
  originalAssetId  String
  optimizedAssetId String?
  workspaceId      String
  platform         SocialProvider
  
  // Optimization Settings
  targetWidth      Int?
  targetHeight     Int?
  compressionLevel Float?   // 0-1
  format           String?  // jpg, png, webp
  
  // Applied Optimizations
  cropped          Boolean  @default(false)
  resized          Boolean  @default(false)
  compressed       Boolean  @default(false)
  filtered         Boolean  @default(false)
  textOverlay      Boolean  @default(false)
  
  // Optimization Results
  sizeBefore       Int
  sizeAfter        Int?
  qualityScore     Float?   // Quality assessment after optimization
  
  // Performance Impact
  loadTimeImprovement Float? // Seconds saved
  engagementPredict   Float? // Predicted engagement improvement
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  originalAsset  Asset     @relation("OriginalAsset", fields: [originalAssetId], references: [id], onDelete: Cascade)
  optimizedAsset Asset?    @relation("OptimizedAsset", fields: [optimizedAssetId], references: [id], onDelete: SetNull)
  workspace      Workspace @relation("WorkspaceImageOptimization", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("image_optimizations")
}

model VisualPerformanceMetric {
  id              String   @id @default(cuid())
  assetId         String
  postId          String?
  workspaceId     String
  platform        SocialProvider?
  
  // Visual Metrics
  viewDuration    Float?   // Average view time in seconds
  clickThroughRate Float?  // CTR for images with links
  saveRate        Float?   // Rate of saves/downloads
  shareRate       Float?   // Rate of shares
  
  // Engagement Correlation
  likesPerView    Float?
  commentsPerView Float?
  engagementRate  Float?
  
  // Visual Factors
  colorScore      Float?   // Color harmony score
  compositionScore Float?  // Rule of thirds, balance, etc.
  contrastScore   Float?   // Visual contrast analysis
  
  // A/B Testing
  testVariant     String?  // A/B test variant identifier
  testGroup       String?  // Control/test group
  
  recordedAt      DateTime @default(now())
  createdAt       DateTime @default(now())

  // Relations
  asset     Asset      @relation("AssetPerformanceMetrics", fields: [assetId], references: [id], onDelete: Cascade)
  post      Post?      @relation("PostVisualMetrics", fields: [postId], references: [id], onDelete: Cascade)
  workspace Workspace  @relation("WorkspaceVisualMetrics", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("visual_performance_metrics")
}

model BrandVisualGuideline {
  id              String   @id @default(cuid())
  workspaceId     String
  name            String
  
  // Brand Colors
  primaryColors   Json     // Primary brand colors (hex)
  secondaryColors Json     // Secondary colors
  accentColors    Json     // Accent colors
  
  // Typography
  primaryFonts    Json     // Primary font stack
  secondaryFonts  Json     // Secondary fonts
  fontSizes       Json     // Approved font sizes
  
  // Logo Guidelines
  logoVariants    Json     // Different logo versions
  logoMinSize     Json     // Minimum size requirements
  logoClearSpace  Json     // Clear space requirements
  
  // Visual Style
  filterSettings  Json?    // Approved filters/effects
  overlayStyles   Json?    // Text overlay styles
  compositionRules Json?   // Composition guidelines
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace @relation("WorkspaceBrandGuidelines", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@map("brand_visual_guidelines")
}

model VisualTrend {
  id              String   @id @default(cuid())
  platform        SocialProvider
  category        String   // e.g., "color", "composition", "style"
  trendName       String
  description     String?
  
  // Trend Data
  popularity      Float    // Popularity score (0-1)
  growthRate      Float?   // Week-over-week growth
  peakDate        DateTime?
  
  // Visual Characteristics
  characteristics Json     // Key visual characteristics
  examples        Json?    // Example image URLs or descriptions
  
  // Geographic/Demographic Data
  regions         Json?    // Popular regions
  demographics    Json?    // Age groups, interests
  
  detectedAt      DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([platform, category, trendName])
  @@map("visual_trends")
}

model ImageABTest {
  id              String   @id @default(cuid())
  workspaceId     String
  testName        String
  description     String?
  
  // Test Configuration
  platform        SocialProvider?
  startDate       DateTime
  endDate         DateTime?
  status          ABTestStatus @default(RUNNING)
  
  // Test Assets
  controlAssetId  String
  variantAssetIds Json     // Array of variant asset IDs
  
  // Results
  totalViews      Int      @default(0)
  controlViews    Int      @default(0)
  controlEngagement Float?
  winningVariant  String?  // Asset ID of winning variant
  confidenceLevel Float?   // Statistical confidence (0-1)
  
  // Insights
  insights        Json?    // AI-generated insights
  recommendations Json?    // Optimization recommendations
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace     Workspace @relation("WorkspaceImageABTests", fields: [workspaceId], references: [id], onDelete: Cascade)
  controlAsset  Asset     @relation("ABTestControlAsset", fields: [controlAssetId], references: [id], onDelete: Cascade)

  @@map("image_ab_tests")
}

model ContentABTest {
  id              String   @id @default(cuid())
  workspaceId     String
  testName        String
  description     String?
  
  // Test Configuration
  testType        ABTestType       @default(CONTENT)
  platform        SocialProvider?
  startDate       DateTime
  endDate         DateTime?
  status          ABTestStatus     @default(DRAFT)
  sampleSize      Int?             // Minimum audience size for statistical significance
  confidenceLevel Float            @default(0.95) // Statistical confidence threshold
  
  // Control Content
  controlTitle    String?
  controlContent  String
  controlHashtags String[]
  controlMediaIds String[]         // Asset IDs for control version
  
  // Variants
  variants        Json             // Array of variant content objects
  
  // Test Parameters
  trafficSplit    Json             // Traffic allocation per variant (e.g., {"control": 50, "variant1": 50})
  testDuration    Int?             // Test duration in hours
  autoOptimize    Boolean          @default(false) // Auto-select winning variant
  
  // Results & Metrics
  totalViews      Int              @default(0)
  controlMetrics  Json?            // Engagement metrics for control
  variantMetrics  Json?            // Engagement metrics for all variants
  winningVariant  String?          // "control" or variant key
  statisticalSignificance Float?   // P-value or confidence score
  liftPercentage  Float?           // Performance improvement %
  
  // AI-Powered Insights
  aiRecommendations Json?          // AI analysis of results
  nextTestSuggestions Json?        // Follow-up test recommendations
  audienceSegments Json?           // Segment-based performance analysis
  optimizationInsights Json?       // Content optimization suggestions
  
  // Automation
  autoPublish     Boolean          @default(false)  // Auto-publish winning variant
  publishedAt     DateTime?        // When winning variant was published
  scheduledFor    DateTime?        // Scheduled publish time for winner
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  // Relations
  workspace       Workspace        @relation("WorkspaceContentABTests", fields: [workspaceId], references: [id], onDelete: Cascade)
  executionLogs   ABTestExecution[] @relation("ABTestExecutions")

  @@map("content_ab_tests")
}

model ABTestExecution {
  id            String       @id @default(cuid())
  abTestId      String
  variant       String       // "control" or variant key
  userId        String?      // User who saw this variant
  sessionId     String?      // Session identifier
  
  // Interaction Data
  viewed        Boolean      @default(false)
  clicked       Boolean      @default(false)
  engaged       Boolean      @default(false)  // Liked, commented, shared
  converted     Boolean      @default(false)  // Achieved goal action
  
  // Metrics
  engagementScore Float?     // Calculated engagement score
  timeSpent     Int?         // Time spent viewing (seconds)
  interactions  Json?        // Detailed interaction data
  
  // Context
  platform      SocialProvider?
  deviceType    String?      // mobile, desktop, tablet
  location      String?      // Geographic location
  timestamp     DateTime     @default(now())
  
  // Relations
  abTest        ContentABTest @relation("ABTestExecutions", fields: [abTestId], references: [id], onDelete: Cascade)
  
  @@map("ab_test_executions")
}

// ========================================
// AUDIENCE INTELLIGENCE & SENTIMENT ANALYSIS
// ========================================

model SentimentAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  postId          String?
  sourceType      SentimentSource // comment, mention, dm, review
  sourceId        String   // Original comment/mention ID
  content         String   // Text content being analyzed
  
  // Sentiment Scores
  overallScore    Float    // -1 to 1 (negative to positive)
  positiveScore   Float    // 0 to 1
  negativeScore   Float    // 0 to 1
  neutralScore    Float    // 0 to 1
  confidenceScore Float    // 0 to 1
  
  // Emotion Analysis
  emotions        Json?    // {joy: 0.8, anger: 0.1, fear: 0.1}
  
  // Context
  platform        SocialProvider
  authorId        String?  // Social platform user ID
  authorHandle    String?  // @username
  
  // Metadata
  language        String?
  detectedTopics  String[] // Keywords/topics detected
  isInfluencer    Boolean @default(false)
  followerCount   Int?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceSentimentAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)
  post        Post?     @relation("PostSentimentAnalysis", fields: [postId], references: [id], onDelete: Cascade)

  @@index([workspaceId, createdAt])
  @@index([postId, overallScore])
  @@index([platform, createdAt])
  @@map("sentiment_analysis")
}

model SentimentTrend {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Time Period
  date            DateTime // Daily aggregation
  platform        SocialProvider?
  
  // Aggregated Metrics
  totalMentions   Int      @default(0)
  avgSentiment    Float    // Average sentiment score
  positiveCount   Int      @default(0)
  negativeCount   Int      @default(0)
  neutralCount    Int      @default(0)
  
  // Trend Analysis
  sentimentChange Float?   // Change from previous period
  volumeChange    Float?   // Change in mention volume
  
  // Top Topics/Keywords
  topPositiveTopics String[]
  topNegativeTopics String[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceSentimentTrends", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, date, platform])
  @@map("sentiment_trends")
}

model CrisisAlert {
  id              String      @id @default(cuid())
  workspaceId     String
  
  // Alert Details
  alertType       CrisisType
  severity        AlertSeverity
  title           String
  description     String
  
  // Trigger Data
  triggerMetric   String      // sentiment_spike, volume_surge, negative_trend
  currentValue    Float
  thresholdValue  Float
  timeframe       String      // 1h, 6h, 24h
  
  // Context
  platform        SocialProvider?
  affectedPosts   String[]    // Post IDs
  keyMentions     String[]    // Critical mention IDs
  
  // Status
  status          AlertStatus @default(ACTIVE)
  acknowledgedBy  String?     // User ID who acknowledged
  acknowledgedAt  DateTime?
  resolvedAt      DateTime?
  
  // Escalation
  notificationsSent Json?     // {email: true, slack: false, sms: true}
  escalationLevel   Int       @default(1)
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceCrisisAlerts", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, createdAt])
  @@index([severity, createdAt])
  @@map("crisis_alerts")
}

model AudienceSegment {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Segment Details
  name            String
  description     String?
  
  // Segmentation Criteria
  segmentType     SegmentType // behavioral, demographic, psychographic, platform
  criteria        Json        // Flexible criteria object
  
  // Size & Metrics
  estimatedSize   Int      @default(0)
  actualSize      Int      @default(0)
  
  // Engagement Patterns
  avgEngagementRate Float?
  preferredPlatforms SocialProvider[]
  activeHours     Json?    // [{hour: 9, score: 0.8}]
  topContentTypes String[] // image, video, text, link
  
  // AI Insights
  personalityTraits Json?  // {openness: 0.7, conscientiousness: 0.5}
  interests         String[]
  demographicProfile Json? // {age_range: "25-34", location: "US"}
  
  // Performance
  conversionRate  Float?
  avgOrderValue   Float?
  lifetimeValue   Float?
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace           Workspace               @relation("WorkspaceAudienceSegments", fields: [workspaceId], references: [id], onDelete: Cascade)
  contentRecommendations ContentRecommendation[]
  postingRecommendations PostingTimeRecommendation[]

  @@index([workspaceId, isActive])
  @@map("audience_segments")
}

model ContentRecommendation {
  id              String   @id @default(cuid())
  workspaceId     String
  segmentId       String
  
  // Recommendation Details
  title           String
  description     String
  recommendationType RecommendationType
  
  // Content Suggestions
  suggestedTopics String[]
  suggestedTone   ContentTone?
  suggestedFormats String[]  // image, video, carousel, story
  suggestedHashtags String[]
  
  // Platform Optimization
  platforms       SocialProvider[]
  
  // Performance Prediction
  predictedEngagement Float?
  predictedReach      Int?
  confidenceScore     Float?
  
  // Status
  status          RecommendationStatus @default(PENDING)
  usedAt          DateTime?
  resultPostId    String?
  actualPerformance Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace       @relation("WorkspaceContentRecommendations", fields: [workspaceId], references: [id], onDelete: Cascade)
  segment   AudienceSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status])
  @@index([segmentId, createdAt])
  @@map("content_recommendations")
}

model PostingTimeRecommendation {
  id              String   @id @default(cuid())
  workspaceId     String
  segmentId       String
  
  // Time Recommendations
  platform        SocialProvider
  dayOfWeek       Int      // 0-6 (Sunday-Saturday)
  hour            Int      // 0-23
  timezone        String   // UTC offset or timezone name
  
  // Confidence & Performance
  confidenceScore Float    // 0-1
  expectedEngagement Float // Predicted engagement rate
  audienceSize    Int      // Expected audience size at this time
  
  // Supporting Data
  historicalData  Json?    // Historical performance data
  competitorData  Json?    // Competitor posting patterns
  
  // Metadata
  dataPoints      Int      // Number of posts used for analysis
  lastUpdated     DateTime @default(now())
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace Workspace       @relation("WorkspacePostingRecommendations", fields: [workspaceId], references: [id], onDelete: Cascade)
  segment   AudienceSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([segmentId, platform, dayOfWeek, hour])
  @@index([workspaceId, platform])
  @@map("posting_time_recommendations")
}

model EngagementPattern {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Pattern Identification
  patternType     EngagementPatternType
  patternName     String
  description     String
  
  // Pattern Data
  triggers        Json     // What triggers this pattern
  behaviors       Json     // Behavioral characteristics
  timeline        Json     // When this pattern occurs
  
  // Audience Characteristics
  audienceSize    Int      @default(0)
  demographics    Json?    // Age, location, interests
  platforms       SocialProvider[]
  
  // Performance Metrics
  avgEngagementRate Float?
  avgReach         Int?
  conversionRate   Float?
  
  // Confidence & Validity
  confidenceScore Float    // Statistical confidence
  dataPoints      Int      // Number of observations
  
  // Insights
  insights        Json?    // AI-generated insights
  actionableItems Json?    // Recommended actions
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspaceEngagementPatterns", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, patternType])
  @@index([isActive, createdAt])
  @@map("engagement_patterns")
}

// Relations added to existing models:
// - Workspace: Added audience intelligence relations
// - Post: Added sentiment analysis relation

// ========================================
// AUDIENCE INTELLIGENCE ENUMS
// ========================================

enum SentimentSource {
  COMMENT
  MENTION
  DIRECT_MESSAGE
  REVIEW
  SHARE
  REPLY
}

enum CrisisType {
  SENTIMENT_SPIKE
  VOLUME_SURGE
  NEGATIVE_TREND
  BRAND_ATTACK
  PR_CRISIS
  VIRAL_NEGATIVE
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertStatus {
  ACTIVE
  ACKNOWLEDGED
  INVESTIGATING
  RESOLVED
  FALSE_POSITIVE
}

enum SegmentType {
  BEHAVIORAL
  DEMOGRAPHIC
  PSYCHOGRAPHIC
  PLATFORM
  ENGAGEMENT
  LIFECYCLE
}

enum RecommendationType {
  CONTENT_TOPIC
  CONTENT_FORMAT
  POSTING_TIME
  HASHTAG
  TONE
  PLATFORM
}

enum RecommendationStatus {
  PENDING
  ACCEPTED
  REJECTED
  IMPLEMENTED
  TESTING
}

enum EngagementPatternType {
  SEASONAL
  WEEKLY
  DAILY
  EVENT_BASED
  CONTENT_TYPE
  PLATFORM_SPECIFIC
  DEMOGRAPHIC
}

// ========================================
// ADVANCED AUTOMATION & INTELLIGENCE
// ========================================

model TrendAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Source Information
  sourceType      TrendSource // news, social, viral, competitor
  sourceUrl       String?
  sourceTitle     String
  sourceContent   String?
  
  // Trend Data
  trendScore      Float    // 0-1 relevance score
  viralityScore   Float?   // 0-1 virality potential
  industryMatch   Float    // 0-1 industry relevance
  
  // Content Suggestions
  suggestedTopics String[]
  suggestedAngles String[]
  suggestedFormats String[] // video, image, text, poll
  
  // Metadata
  tags            String[]
  category        String
  language        String   @default("en")
  detectedAt      DateTime @default(now())
  expiresAt       DateTime? // When trend becomes outdated
  
  // AI Analysis
  aiAnalysis      Json?    // Detailed AI insights
  opportunityScore Float?  // 0-1 content opportunity score
  
  // Status
  status          TrendStatus @default(ACTIVE)
  usedInContent   Boolean     @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceTrendAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)
  contentSuggestions ContentSuggestion[]

  @@index([workspaceId, status, detectedAt])
  @@index([trendScore, viralityScore])
  @@map("trend_analysis")
}

model ContentGapAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Analysis Period
  analysisStartDate DateTime
  analysisEndDate   DateTime
  
  // Gap Identification
  missingTopics   String[]
  underperformingTopics String[]
  competitorTopics String[] // Topics competitors cover but we don't
  
  // Recommendations
  priorityTopics  Json     // [{topic, priority, reasoning}]
  suggestedContent Json    // [{topic, contentType, reasoning}]
  contentCalendarGaps Json // [{date, gap, opportunity}]
  
  // Competitive Analysis
  competitorAdvantages String[]
  differentiationOpportunities String[]
  
  // Performance Predictions
  expectedImpact  Json?    // Predicted performance if gaps are filled
  confidenceScore Float    // 0-1 confidence in recommendations
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceContentGapAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, analysisEndDate])
  @@map("content_gap_analysis")
}

model CompetitorAnalysis {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Competitor Information
  competitorName  String
  competitorHandle String?
  platforms       SocialProvider[]
  
  // Content Analysis
  contentThemes   String[]
  postingFrequency Float    // Posts per day
  avgEngagement   Float
  topPerformingTypes String[]
  
  // Strategy Insights
  contentStrategy Json     // Detailed strategy analysis
  strengthsWeaknesses Json // {strengths: [], weaknesses: []}
  
  // Differentiation Opportunities
  differentiationStrategies Json // Specific strategies to stand out
  contentGaps     String[] // What they're missing
  overlapAreas    String[] // Where we compete directly
  
  // Performance Comparison
  performanceMetrics Json  // Comparison metrics
  benchmarkData   Json?    // Historical performance data
  
  // Update Tracking
  lastAnalyzedAt  DateTime @default(now())
  analysisVersion Int      @default(1)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceCompetitorAnalysis", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, competitorName])
  @@index([workspaceId, lastAnalyzedAt])
  @@map("competitor_analysis")
}

model ContentSuggestion {
  id              String   @id @default(cuid())
  workspaceId     String
  trendAnalysisId String?
  
  // Suggestion Details
  title           String
  description     String
  suggestedContent String?
  
  // Content Properties
  contentType     ContentType
  platforms       SocialProvider[]
  topics          String[]
  hashtags        String[]
  
  // AI-Generated Elements
  aiGeneratedCaption String?
  suggestedMedia  Json?    // Media suggestions/requirements
  callToAction    String?
  
  // Performance Prediction
  predictedEngagement Float?
  predictedReach     Int?
  viralPotential     Float?  // 0-1 score
  
  // Scheduling
  suggestedPostTime DateTime?
  timeZone         String?
  
  // Status & Tracking
  status          SuggestionStatus @default(PENDING)
  priority        Int              @default(3) // 1-5 priority
  implementedAt   DateTime?
  resultPostId    String?
  actualPerformance Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace      @relation("WorkspaceContentSuggestions", fields: [workspaceId], references: [id], onDelete: Cascade)
  trendAnalysis   TrendAnalysis? @relation(fields: [trendAnalysisId], references: [id], onDelete: SetNull)

  @@index([workspaceId, status, priority])
  @@index([suggestedPostTime])
  @@map("content_suggestions")
}

model SmartResponse {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Context Information
  sourceType      ResponseSource // comment, dm, mention, review
  sourceId        String         // Original message ID
  sourcePlatform  SocialProvider
  originalMessage String
  
  // Response Generation
  suggestedResponse String
  responseType    ResponseType   // answer, acknowledge, escalate, custom
  tone           ResponseTone    // friendly, professional, casual, empathetic
  
  // Context Analysis
  sentiment      Float?          // Sentiment of original message
  intent         String?         // Detected user intent
  category       String?         // Support, complaint, compliment, question
  urgency        ResponseUrgency // low, medium, high, critical
  
  // AI Confidence & Metadata
  confidenceScore Float          // 0-1 confidence in response
  languageDetected String        // Detected language
  requiresHuman   Boolean        @default(false)
  
  // Status & Usage
  status         ResponseStatus  @default(PENDING)
  usedAt         DateTime?
  feedback       String?         // Human feedback on response quality
  rating         Int?            // 1-5 rating of response quality
  
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  // Relations
  workspace      Workspace       @relation("WorkspaceSmartResponses", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, urgency])
  @@index([sourcePlatform, responseType])
  @@map("smart_responses")
}

model ResponseTemplate {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Template Information
  category        String           // greeting, support, faq, etc.
  keywords        String[]         // Keywords that trigger this template
  template        String           // Template text with variables
  tone            ResponseTone
  platform        SocialProvider?
  language        String           @default("en")
  
  // Usage Statistics
  usageCount      Int              @default(0)
  lastUsed        DateTime?
  
  // Meta Information
  isActive        Boolean          @default(true)
  createdBy       String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  workspace       Workspace        @relation("WorkspaceResponseTemplates", fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@index([workspaceId, category, isActive])
  @@index([keywords])
  @@map("response_templates")
}

model AutomationRule {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Rule Definition
  name            String
  description     String?
  ruleType        AutomationType
  
  // Trigger Conditions
  triggers        Json     // Complex trigger conditions
  conditions      Json     // Additional conditions to check
  
  // Actions
  actions         Json     // Actions to perform when triggered
  
  // Settings
  isActive        Boolean  @default(true)
  priority        Int      @default(3) // 1-5 priority
  
  // Execution Tracking
  executionCount  Int      @default(0)
  successCount    Int      @default(0)
  lastExecutedAt  DateTime?
  lastError       String?
  
  // Rate Limiting
  maxExecutionsPerHour Int? @default(10)
  maxExecutionsPerDay  Int? @default(100)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace         @relation("WorkspaceAutomationRules", fields: [workspaceId], references: [id], onDelete: Cascade)
  executions      AutomationExecution[]

  @@index([workspaceId, isActive, ruleType])
  @@map("automation_rules")
}

model AutomationExecution {
  id              String   @id @default(cuid())
  ruleId          String
  workspaceId     String
  
  // Execution Details
  triggeredBy     String?  // What triggered this execution
  triggerData     Json?    // Data that triggered the execution
  
  // Execution Results
  status          ExecutionStatus
  executedActions Json?    // Actions that were executed
  results         Json?    // Results of the execution
  
  // Error Handling
  errorMessage    String?
  retryCount      Int      @default(0)
  maxRetries      Int      @default(3)
  
  // Timing
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  duration        Int?     // Execution time in milliseconds
  
  createdAt       DateTime @default(now())

  // Relations
  rule            AutomationRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)
  workspace       Workspace      @relation("WorkspaceAutomationExecutions", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([ruleId, status])
  @@index([workspaceId, startedAt])
  @@map("automation_executions")
}

model ContentCalendarOptimization {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Optimization Period
  startDate       DateTime
  endDate         DateTime
  
  // Current State Analysis
  currentSchedule Json     // Current posting schedule analysis
  performanceGaps Json     // Identified performance gaps
  
  // AI Recommendations
  optimizedSchedule Json   // AI-optimized posting schedule
  improvementPredictions Json // Expected improvements
  
  // Implementation
  suggestedChanges Json    // Specific changes to make
  implementationPlan Json  // Step-by-step implementation
  
  // Performance Tracking
  baselineMetrics Json?    // Performance before optimization
  projectedMetrics Json?   // Projected performance after
  actualResults   Json?    // Actual results after implementation
  
  // Status
  status          OptimizationStatus @default(PENDING)
  implementedAt   DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceCalendarOptimizations", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, status, startDate])
  @@map("content_calendar_optimizations")
}

model Translation {
  id              String   @id @default(cuid())
  workspaceId     String
  
  // Content Information
  originalContent String
  originalLanguage String
  targetLanguage  String
  contentType     String   // post, comment, dm, etc.
  
  // Translation
  translatedContent String
  translationService String // openai, google, azure
  
  // Quality & Confidence
  confidenceScore Float    // 0-1 translation confidence
  qualityScore    Float?   // 0-1 human-rated quality
  
  // Context & Metadata
  context         Json?    // Additional context for translation
  culturalAdaptation Boolean @default(false) // Whether cultural adaptation was applied
  
  // Usage Tracking
  usageCount      Int      @default(0)
  lastUsedAt      DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  workspace       Workspace @relation("WorkspaceTranslations", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, originalContent, targetLanguage])
  @@index([originalLanguage, targetLanguage])
  @@map("translations")
}


// ========================================
// ADVANCED AUTOMATION ENUMS
// ========================================

enum TrendSource {
  NEWS
  SOCIAL
  VIRAL
  COMPETITOR
  INDUSTRY
  HASHTAG
}

enum TrendStatus {
  ACTIVE
  DECLINING
  EXPIRED
  USED
}

enum ContentType {
  TEXT
  IMAGE
  VIDEO
  CAROUSEL
  STORY
  REEL
  POLL
  LIVE
  THREAD
}

enum SuggestionStatus {
  PENDING
  APPROVED
  REJECTED
  IMPLEMENTED
  EXPIRED
}

enum ResponseSource {
  COMMENT
  DM
  MENTION
  REVIEW
  CHAT
}

enum ResponseType {
  ANSWER
  ACKNOWLEDGE
  ESCALATE
  CUSTOM
  AUTO_RESOLVE
}

enum ResponseTone {
  FRIENDLY
  PROFESSIONAL
  CASUAL
  EMPATHETIC
  FORMAL
  HUMOROUS
}

enum ResponseUrgency {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ResponseStatus {
  PENDING
  APPROVED
  REJECTED
  SENT
  FAILED
}

enum AutomationType {
  CONTENT_SUGGESTION
  SMART_RESPONSE
  CRISIS_MANAGEMENT
  ENGAGEMENT_FOLLOW_UP
  SCHEDULING_OPTIMIZATION
  TREND_MONITORING
  COMPETITOR_TRACKING
}

enum ExecutionStatus {
  PENDING
  RUNNING
  SUCCESS
  FAILED
  CANCELLED
  RETRY
}

enum OptimizationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

// ========================================
// VISUAL ANALYTICS ENUMS
// ========================================

enum ABTestStatus {
  DRAFT
  RUNNING
  COMPLETED
  PAUSED
  CANCELLED
}

enum ABTestType {
  CONTENT      // Content/copy testing
  TIMING       // Posting time optimization
  HASHTAGS     // Hashtag strategy testing
  VISUAL       // Image/video testing
  AUDIENCE     // Audience targeting testing
  HYBRID       // Multiple element testing
}

// ========================================
// INTERNATIONALIZATION MODELS
// ========================================

model TranslationCache {
  id               String    @id @default(cuid())
  sourceText       String
  sourceLanguage   String    @default("en")
  targetLanguage   String
  translatedText   String
  context          String?
  workspaceId      String?
  quality          Decimal?  @default(0.95)
  usageCount       Int       @default(1)
  expiresAt        DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  workspace Workspace? @relation("WorkspaceTranslationCache", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([sourceText, targetLanguage])
  @@index([workspaceId])
  @@index([expiresAt])
  @@map("translation_cache")
}

model UserLanguagePreference {
  id           String   @id @default(cuid())
  userId       String
  locale       String
  isDefault    Boolean  @default(false)
  proficiency  String   @default("native") // native, fluent, intermediate, basic
  autoTranslate Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation("UserLanguagePreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, locale])
  @@index([userId])
  @@index([locale])
  @@map("user_language_preferences")
}

model WorkspaceContentTranslation {
  id                 String   @id @default(cuid())
  workspaceId        String
  contentType        String   // post_template, campaign_name, etc.
  contentId          String
  locale             String
  translatedContent  Json
  isHumanTranslated  Boolean  @default(false)
  translatedBy       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  workspace    Workspace @relation("WorkspaceContentTranslations", fields: [workspaceId], references: [id], onDelete: Cascade)
  translatedByUser User?     @relation("ContentTranslatedBy", fields: [translatedBy], references: [id], onDelete: SetNull)

  @@unique([contentId, locale])
  @@index([workspaceId, contentType])
  @@index([contentId, locale])
  @@map("workspace_content_translations")
}

model CustomDashboard {
  id          String   @id @default(cuid())
  userId      String
  workspaceId String
  name        String   @default("My Dashboard")
  description String?
  isDefault   Boolean  @default(false)
  
  // Dashboard Layout & Configuration
  layout      Json     // Grid layout configuration
  widgets     Json     // Widget configurations array
  settings    Json?    // Dashboard-wide settings (colors, refresh rate, etc.)
  
  // Metadata
  isPublic    Boolean  @default(false)
  tags        String[] @default([])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User      @relation("UserCustomDashboards", fields: [userId], references: [id], onDelete: Cascade)
  workspace   Workspace @relation("WorkspaceCustomDashboards", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, workspaceId, name])
  @@index([userId, workspaceId])
  @@index([workspaceId, isPublic])
  @@map("custom_dashboards")
}

model BudgetSettings {
  id                    String   @id @default(cuid())
  workspaceId           String   @unique
  
  // General Settings
  defaultCurrency       String   @default("USD")
  budgetPeriod         String   @default("monthly") // monthly, quarterly, yearly
  
  // Alert Settings
  warningThreshold     Int      @default(75)  // Percentage
  criticalThreshold    Int      @default(90)  // Percentage
  enableEmailAlerts    Boolean  @default(true)
  enablePushAlerts     Boolean  @default(true)
  emailRecipients      String[] @default([])
  
  // Budget Limits
  dailyLimit           Float?
  monthlyLimit         Float?
  perCampaignLimit     Float?
  autoStopAtLimit      Boolean  @default(false)
  
  // Reporting
  reportFrequency      String   @default("monthly") // daily, weekly, monthly
  enableAutomatedReports Boolean @default(false)
  reportRecipients     String[] @default([])
  includeProjections   Boolean  @default(true)
  includeRecommendations Boolean @default(true)
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  
  // Relations
  workspace            Workspace @relation("WorkspaceBudgetSettings", fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@map("budget_settings")
}

// ========================================
// USER SETTINGS & PREFERENCES
// ========================================

model UserSettings {
  id          String   @id @default(cuid())
  userId      String   @unique
  
  // Appearance Settings
  theme       String   @default("system") // light, dark, system
  colorScheme String   @default("default") // default, blue, green, purple, etc.
  fontScale   String   @default("normal") // small, normal, large
  compactMode Boolean  @default(false)
  sidebarCollapsed Boolean @default(false)
  
  // Language & Time Settings
  language    String   @default("en")
  timezone    String   @default("UTC")
  dateFormat  String   @default("MM/dd/yyyy") // MM/dd/yyyy, dd/MM/yyyy, yyyy-MM-dd
  timeFormat  String   @default("12h") // 12h, 24h
  weekStartDay String  @default("sunday") // sunday, monday
  
  // Dashboard Preferences
  defaultView String   @default("overview") // overview, posts, analytics, inbox
  showWelcomeMessage Boolean @default(true)
  enableAnimations Boolean @default(true)
  enableSounds    Boolean @default(false)
  
  // Privacy Settings
  profileVisible Boolean @default(true)
  activityVisible Boolean @default(true)
  analyticsOptOut Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user User @relation("UserSettingsRelation", fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("user_settings")
}

model NotificationPreferences {
  id      String @id @default(cuid())
  userId  String @unique
  
  // Channel Preferences (JSON structure for flexibility)
  // Format: { "type": { "email": boolean, "push": boolean, "inApp": boolean } }
  preferences Json @default("{}")
  
  // Global Settings
  emailEnabled     Boolean @default(true)
  pushEnabled      Boolean @default(true)
  inAppEnabled     Boolean @default(true)
  soundEnabled     Boolean @default(true)
  
  // Digest Settings
  dailyDigest      Boolean @default(false)
  weeklyDigest     Boolean @default(true)
  monthlyDigest    Boolean @default(false)
  digestTime       String  @default("09:00") // HH:mm format
  digestTimezone   String  @default("UTC")
  
  // Do Not Disturb
  dndEnabled       Boolean @default(false)
  dndStartTime     String? // HH:mm format
  dndEndTime       String? // HH:mm format
  dndDays          String[] @default([]) // ["monday", "tuesday", etc.]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user User @relation("UserNotificationPreferences", fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notification_preferences")
}

// ========================================
// CLIENT BRANDING & CUSTOMIZATION
// ========================================

model ClientBranding {
  id          String @id @default(cuid())
  workspaceId String @unique // One branding config per workspace
  clientId    String? // Optional - can be workspace-level or client-specific
  
  // Basic Branding
  title       String @default("SociallyHub")
  logoUrl     String?
  faviconUrl  String?
  
  // Color Scheme
  primaryColor   String @default("#3B82F6") // Tailwind blue-500
  secondaryColor String @default("#1E40AF") // Tailwind blue-700
  accentColor    String @default("#10B981") // Tailwind emerald-500
  
  // Advanced Color Palette (JSON for flexibility)
  colorPalette Json @default("{}")
  
  // Typography
  fontFamily     String @default("Inter")
  fontScale      String @default("normal") // small, normal, large
  
  // Layout Customization
  layoutConfig Json @default("{}") // Sidebar position, header style, etc.
  
  // Custom CSS (for advanced customization)
  customCSS    String?
  
  // Feature Toggles
  features Json @default("{}") // Enable/disable specific features per client
  
  // White Label Settings
  isWhiteLabel Boolean @default(false)
  customDomain String?
  hideCredits  Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  workspace Workspace @relation("WorkspaceClientBranding", fields: [workspaceId], references: [id], onDelete: Cascade)
  client    Client?   @relation("ClientBrandingRelation", fields: [clientId], references: [id], onDelete: SetNull)
  
  @@map("client_branding")
}

model LandingPageConfig {
  id          String @id @default(cuid())
  workspaceId String @unique
  
  // Page Metadata
  title       String @default("SociallyHub - Social Media Management Platform")
  description String @default("Manage all your social media accounts from one powerful platform")
  keywords    String[] @default([])
  
  // Hero Section
  heroConfig Json @default("{}")
  
  // Features Section
  featuresConfig Json @default("{}")
  
  // Testimonials Section
  testimonialsConfig Json @default("{}")
  
  // Pricing Section
  pricingConfig Json @default("{}")
  
  // CTA Sections
  ctaConfig Json @default("{}")
  
  // Footer Configuration
  footerConfig Json @default("{}")
  
  // SEO & Analytics
  analyticsCode String?
  seoConfig     Json @default("{}")
  
  // Custom Sections (for flexibility)
  customSections Json @default("[]")
  
  // Publication Status
  isPublished Boolean @default(false)
  publishedAt DateTime?
  
  // Version Control
  version     Int @default(1)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  workspace Workspace @relation("WorkspaceLandingPage", fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@map("landing_page_config")
}

// ========================================
// PLATFORM CREDENTIALS
// ========================================

model PlatformCredentials {
  id          String   @id @default(cuid())
  workspaceId String
  platform    String   // 'TWITTER', 'FACEBOOK', 'INSTAGRAM', etc.

  // Credentials stored as encrypted JSON
  credentials Json     // Platform-specific credentials (API keys, secrets, etc.)

  // Configuration
  isActive    Boolean  @default(true)
  environment String   @default("production") // 'production', 'sandbox', 'development'

  // Validation status
  lastValidated DateTime?
  validationStatus String @default("pending") // 'pending', 'valid', 'invalid', 'expired'
  validationError String?

  // Usage tracking
  lastUsed    DateTime?
  usageCount  Int      @default(0)

  // Metadata
  configuredBy String?  // User ID who configured these credentials
  notes       String?   // Optional notes about the configuration

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  workspace   Workspace @relation("WorkspacePlatformCredentials", fields: [workspaceId], references: [id], onDelete: Cascade)

  // Ensure one credential set per platform per workspace
  @@unique([workspaceId, platform])
  @@map("platform_credentials")
}

// ========================================
// HELP CENTER MODELS
// ========================================

model HelpCategory {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  icon        String?  // Lucide icon name
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  articles      HelpArticle[]
  faqs          HelpFAQ[]
  searchQueries HelpSearchQuery[]
  videoTutorials VideoTutorial[]
  videoPlaylists VideoPlaylist[]
  analytics     HelpCategoryAnalytics[]

  @@index([slug])
  @@index([isActive])
  @@map("help_categories")
}

model HelpArticle {
  id              String      @id @default(cuid())
  title           String
  slug            String      @unique
  content         String      @db.Text // Rich text content
  excerpt         String?
  categoryId      String
  tags            String[]
  status          String      @default("published") // draft, published, archived
  views           Int         @default(0)
  helpfulVotes    Int         @default(0)
  notHelpfulVotes Int         @default(0)
  authorId        String?
  featuredImage   String?
  readingTime     Int?        // Estimated reading time in minutes
  relatedArticles String[]    // Array of related article IDs
  seoTitle        String?
  seoDescription  String?
  publishedAt     DateTime?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  category        HelpCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  author          User?        @relation("HelpArticleAuthor", fields: [authorId], references: [id], onDelete: SetNull)
  comments        HelpArticleComment[]
  bookmarks       HelpArticleBookmark[] @relation("ArticleBookmarks")
  revisions       HelpArticleRevision[]
  workflows       HelpArticleWorkflow[]
  media           HelpArticleMedia[]
  analytics       HelpArticleAnalytics[]
  relationsFrom   HelpArticleRelation[] @relation("ArticleRelationsFrom")
  relationsTo     HelpArticleRelation[] @relation("ArticleRelationsTo")

  @@index([categoryId])
  @@index([status])
  @@index([publishedAt])
  @@index([slug])
  @@map("help_articles")
}

model HelpArticleComment {
  id          String      @id @default(cuid())
  articleId   String
  content     String      @db.Text
  type        String      @default("comment") // comment, feedback, question
  authorId    String?
  authorName  String?
  authorEmail String?
  isApproved  Boolean     @default(false)
  isSpam      Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  article     HelpArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)
  author      User?       @relation("HelpArticleCommentAuthor", fields: [authorId], references: [id], onDelete: SetNull)

  @@index([articleId])
  @@index([isApproved])
  @@map("help_article_comments")
}

model HelpArticleBookmark {
  id        String      @id @default(cuid())
  userId    String
  articleId String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relations
  user      User        @relation("UserBookmarks", fields: [userId], references: [id], onDelete: Cascade)
  article   HelpArticle @relation("ArticleBookmarks", fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@index([userId])
  @@index([articleId])
  @@map("help_article_bookmarks")
}

model HelpFAQ {
  id              String      @id @default(cuid())
  question        String
  answer          String      @db.Text // Rich text content
  categoryId      String
  sortOrder       Int         @default(0)
  views           Int         @default(0)
  helpfulVotes    Int         @default(0)
  notHelpfulVotes Int         @default(0)
  isActive        Boolean     @default(true)
  isPinned        Boolean     @default(false) // Pin important FAQs to top
  relatedArticles String[]    // Array of related article IDs

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  category        HelpCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([isActive])
  @@index([isPinned])
  @@map("help_faqs")
}

// Video Tutorial Models
model VideoTutorial {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  description     String?  @db.Text
  categoryId      String
  thumbnailUrl    String?
  videoUrl        String   // YouTube/Vimeo URL or direct video file
  videoPlatform   String   @default("youtube") // youtube, vimeo, direct
  videoId         String?  // Platform-specific video ID
  duration        Int?     // Duration in seconds
  difficulty      String   @default("beginner") // beginner, intermediate, advanced
  tags            String[] @default([])
  transcript      String?  @db.Text

  // SEO and Analytics
  seoTitle        String?
  seoDescription  String?
  views           Int      @default(0)
  likes           Int      @default(0)
  dislikes        Int      @default(0)
  completions     Int      @default(0) // How many users completed watching
  averageRating   Float?   @default(0)

  // Content Management
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  isFeatured      Boolean  @default(false)
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?

  // Authoring
  authorId        String?
  authorName      String?
  authorAvatar    String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  category        HelpCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  playlists       VideoPlaylistItem[]
  userProgress    VideoUserProgress[]

  @@index([categoryId])
  @@index([isActive, isPublished])
  @@index([isFeatured])
  @@index([difficulty])
  @@index([videoPlatform])
  @@index([publishedAt])
  @@map("video_tutorials")
}

model VideoPlaylist {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  description     String?  @db.Text
  thumbnailUrl    String?
  categoryId      String?

  // Content Management
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  isFeatured      Boolean  @default(false)
  isPublished     Boolean  @default(false)

  // Analytics
  views           Int      @default(0)
  totalDuration   Int      @default(0) // Total duration in seconds
  videoCount      Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  category        HelpCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  videos          VideoPlaylistItem[]

  @@index([categoryId])
  @@index([isActive, isPublished])
  @@index([isFeatured])
  @@map("video_playlists")
}

model VideoPlaylistItem {
  id          String   @id @default(cuid())
  playlistId  String
  videoId     String
  sortOrder   Int      @default(0)

  createdAt   DateTime @default(now())

  // Relations
  playlist    VideoPlaylist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  video       VideoTutorial @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([playlistId, videoId])
  @@index([playlistId, sortOrder])
  @@map("video_playlist_items")
}

model VideoUserProgress {
  id              String   @id @default(cuid())
  userId          String
  videoId         String
  watchTime       Int      @default(0) // Watched time in seconds
  lastPosition    Int      @default(0) // Last playback position in seconds
  isCompleted     Boolean  @default(false)
  rating          Int?     // 1-5 star rating
  feedback        String?  @db.Text

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  video           VideoTutorial @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
  @@index([userId])
  @@index([videoId])
  @@index([isCompleted])
  @@map("video_user_progress")
}

model HelpSearchQuery {
  id              String   @id @default(cuid())
  query           String
  categoryId      String?
  resultsCount    Int      @default(0)
  clickedArticles String[] // Array of article IDs that were clicked
  userAgent       String?
  ipAddress       String?
  sessionId       String?

  createdAt       DateTime @default(now())

  // Relations
  category        HelpCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([query])
  @@index([createdAt])
  @@index([resultsCount])
  @@map("help_search_queries")
}

model HelpSearchSuggestion {
  id          String   @id @default(cuid())
  query       String   @unique
  frequency   Int      @default(1)
  lastUsed    DateTime @default(now())

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([frequency])
  @@index([lastUsed])
  @@map("help_search_suggestions")
}

// ========================================
// DOCUMENTATION SYSTEM
// ========================================

model DocumentationSection {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String?
  icon        String?  // Lucide icon name
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)

  // Relations
  pages       DocumentationPage[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([sortOrder])
  @@index([isActive])
  @@map("documentation_sections")
}

model DocumentationPage {
  id              String              @id @default(cuid())
  title           String
  slug            String              @unique
  content         String              @db.Text // Rich text content with markdown/HTML
  excerpt         String?
  sectionId       String
  tags            String[]
  status          String              @default("published") // draft, published, archived
  views           Int                 @default(0)
  helpfulVotes    Int                 @default(0)
  notHelpfulVotes Int                 @default(0)
  authorId        String?
  featuredImage   String?
  sortOrder       Int                 @default(0)
  isPublic        Boolean             @default(true) // Public or workspace-specific

  // SEO fields
  seoTitle        String?
  seoDescription  String?
  keywords        String[]

  // Content metadata
  estimatedReadTime Int?              // in minutes
  lastReviewed    DateTime?
  publishedAt     DateTime?

  // Relations
  section         DocumentationSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  author          User?                @relation(fields: [authorId], references: [id], onDelete: SetNull, name: "DocumentationAuthor")

  // Extended relations for documentation management
  versions        DocumentationVersion[]
  codeExamples    DocumentationCodeExample[]
  analytics       DocumentationAnalytics[]
  comments        DocumentationComment[]
  crossReferences DocumentationCrossReference[] @relation("PageCrossReferences")
  referencedBy    DocumentationCrossReference[] @relation("ReferencedPageCrossReferences")
  collaborators   DocumentationCollaborator[]
  revisions       DocumentationRevision[]
  workflows       DocumentationWorkflow[]

  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([sectionId])
  @@index([slug])
  @@index([status])
  @@index([isPublic])
  @@index([publishedAt])
  @@index([sortOrder])
  @@map("documentation_pages")
}

// ========================================
// DOCUMENTATION MANAGEMENT SYSTEM
// ========================================

model DocumentationVersion {
  id              String   @id @default(cuid())
  pageId          String
  versionNumber   String   // e.g., "1.0", "2.1", "3.0-beta"
  title           String
  content         String   @db.Text
  changelog       String?  @db.Text
  status          DocumentationVersionStatus @default(DRAFT)
  isActive        Boolean  @default(false) // Only one active version per page
  authorId        String?
  publishedAt     DateTime?
  deprecatedAt    DateTime?

  // Version metadata
  tags            String[]
  apiVersion      String?  // Associated API version
  releaseNotes    String?  @db.Text
  breakingChanges String?  @db.Text

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  author          User?             @relation("DocumentationVersionAuthor", fields: [authorId], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([pageId])
  @@index([versionNumber])
  @@index([status])
  @@index([isActive])
  @@index([apiVersion])
  @@map("documentation_versions")
}

model DocumentationCodeExample {
  id              String   @id @default(cuid())
  pageId          String
  title           String
  description     String?
  language        String   // programming language
  code            String   @db.Text
  output          String?  @db.Text // expected output

  // Code example metadata
  isRunnable      Boolean  @default(false)
  testStatus      DocumentationCodeTestStatus @default(UNTESTED)
  lastTested      DateTime?
  testResults     Json?    // test execution results
  dependencies    String[] // required packages/dependencies
  framework       String?  // framework/library used

  // Organization
  category        String?  // e.g., "Getting Started", "Advanced"
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)

  // Metadata
  authorId        String?
  difficulty      DocumentationDifficulty @default(BEGINNER)
  estimatedTime   Int?     // minutes to complete
  tags            String[]

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  author          User?             @relation("DocumentationCodeAuthor", fields: [authorId], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([pageId])
  @@index([language])
  @@index([category])
  @@index([testStatus])
  @@index([difficulty])
  @@map("documentation_code_examples")
}

model DocumentationAnalytics {
  id              String   @id @default(cuid())
  pageId          String

  // View metrics
  date            DateTime
  views           Int      @default(0)
  uniqueViews     Int      @default(0)
  avgTimeOnPage   Float?   // seconds
  bounceRate      Float?   // percentage

  // Engagement metrics
  helpfulVotes    Int      @default(0)
  notHelpfulVotes Int      @default(0)
  comments        Int      @default(0)
  bookmarks       Int      @default(0)
  shares          Int      @default(0)

  // Search metrics
  searchImpressions Int    @default(0)
  searchClicks    Int      @default(0)
  searchKeywords  String[] // keywords that led to this page

  // Geographic data
  country         String?
  region          String?

  // Technical metrics
  loadTime        Float?   // page load time in seconds
  errorRate       Float?   // percentage of errors

  // User segments
  userType        DocumentationUserType @default(VISITOR)
  referralSource  String?  // where user came from
  device          String?  // mobile, desktop, tablet

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())

  @@unique([pageId, date])
  @@index([pageId])
  @@index([date])
  @@index([userType])
  @@map("documentation_analytics")
}

model DocumentationComment {
  id              String   @id @default(cuid())
  pageId          String
  authorId        String?
  content         String   @db.Text
  status          DocumentationCommentStatus @default(PUBLISHED)

  // Threading
  parentId        String?
  depth           Int      @default(0)

  // Moderation
  isModerated     Boolean  @default(false)
  moderatedBy     String?
  moderatedAt     DateTime?
  moderationReason String?

  // Engagement
  upvotes         Int      @default(0)
  downvotes       Int      @default(0)
  isHelpful       Boolean  @default(false) // marked by author/moderator

  // Metadata
  ipAddress       String?
  userAgent       String?
  isResolved      Boolean  @default(false) // for questions/issues
  resolvedBy      String?
  resolvedAt      DateTime?

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  author          User?             @relation("DocumentationCommentAuthor", fields: [authorId], references: [id], onDelete: SetNull)
  parent          DocumentationComment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies         DocumentationComment[] @relation("CommentReplies")
  moderator       User?             @relation("DocumentationCommentModerator", fields: [moderatedBy], references: [id], onDelete: SetNull)
  resolver        User?             @relation("DocumentationCommentResolver", fields: [resolvedBy], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([pageId])
  @@index([authorId])
  @@index([status])
  @@index([parentId])
  @@index([isResolved])
  @@map("documentation_comments")
}

model DocumentationCrossReference {
  id              String   @id @default(cuid())
  fromPageId      String
  toPageId        String

  // Reference metadata
  referenceType   DocumentationReferenceType @default(RELATED)
  anchorText      String?  // text of the link
  context         String?  // surrounding context

  // Position in content
  position        Int?     // character position in content
  lineNumber      Int?     // line number in content

  // Status
  isActive        Boolean  @default(true)
  isBroken        Boolean  @default(false)
  lastChecked     DateTime?

  // Analytics
  clickCount      Int      @default(0)
  lastClicked     DateTime?

  // Metadata
  createdBy       String?
  description     String?  // purpose of the reference

  // Relations
  fromPage        DocumentationPage @relation("PageCrossReferences", fields: [fromPageId], references: [id], onDelete: Cascade)
  toPage          DocumentationPage @relation("ReferencedPageCrossReferences", fields: [toPageId], references: [id], onDelete: Cascade)
  creator         User?             @relation("DocumentationReferenceCreator", fields: [createdBy], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([fromPageId, toPageId, referenceType])
  @@index([fromPageId])
  @@index([toPageId])
  @@index([referenceType])
  @@index([isActive])
  @@index([isBroken])
  @@map("documentation_cross_references")
}

model DocumentationTemplate {
  id              String   @id @default(cuid())
  workspaceId     String?  // null for global templates
  name            String
  description     String?
  category        String   // e.g., "API", "Tutorial", "Reference"

  // Template structure
  structure       Json     // JSON schema for template structure
  defaultContent  String   @db.Text // default markdown/HTML content
  placeholders    String[] // list of placeholder variables

  // Template metadata
  tags            String[]
  difficulty      DocumentationDifficulty @default(BEGINNER)
  estimatedTime   Int?     // minutes to complete using template

  // Usage
  usageCount      Int      @default(0)
  isActive        Boolean  @default(true)
  isOfficial     Boolean  @default(false) // created by platform team

  // Template settings
  requiredFields  String[] // required fields that must be filled
  optionalFields  String[] // optional fields
  validationRules Json?    // validation rules for template fields

  // Versioning
  version         String   @default("1.0")
  parentTemplate  String?  // ID of parent template (for versions)

  // Relations
  workspace       Workspace? @relation("WorkspaceDocumentationTemplates", fields: [workspaceId], references: [id], onDelete: Cascade)
  createdBy       String?
  author          User?      @relation("DocumentationTemplateAuthor", fields: [createdBy], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([category])
  @@index([isActive])
  @@index([isOfficial])
  @@index([difficulty])
  @@map("documentation_templates")
}

model DocumentationCollaborator {
  id              String   @id @default(cuid())
  pageId          String
  userId          String
  role            DocumentationRole @default(VIEWER)

  // Permissions
  canEdit         Boolean  @default(false)
  canComment      Boolean  @default(true)
  canApprove      Boolean  @default(false)
  canPublish      Boolean  @default(false)
  canDelete       Boolean  @default(false)

  // Activity tracking
  lastAccessed    DateTime?
  contributionCount Int    @default(0)

  // Invitation metadata
  invitedBy       String?
  invitedAt       DateTime?
  acceptedAt      DateTime?
  status          DocumentationCollaboratorStatus @default(PENDING)

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  user            User              @relation("DocumentationCollaborators", fields: [userId], references: [id], onDelete: Cascade)
  inviter         User?             @relation("DocumentationInviter", fields: [invitedBy], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([pageId, userId])
  @@index([pageId])
  @@index([userId])
  @@index([role])
  @@index([status])
  @@map("documentation_collaborators")
}

model DocumentationRevision {
  id              String   @id @default(cuid())
  pageId          String
  authorId        String?

  // Revision content
  title           String
  content         String   @db.Text
  excerpt         String?
  tags            String[]

  // Revision metadata
  revisionNumber  Int
  changeType      DocumentationChangeType @default(EDIT)
  changeSummary   String?  // brief description of changes
  changeDetails   String?  @db.Text // detailed changelog

  // Diff tracking
  contentDiff     Json?    // structured diff of content changes
  wordCount       Int?
  charactersAdded Int      @default(0)
  charactersRemoved Int    @default(0)

  // Status
  status          DocumentationRevisionStatus @default(SAVED)
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?

  // Review process
  needsReview     Boolean  @default(false)
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewStatus    DocumentationReviewStatus?
  reviewComments  String?  @db.Text

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  author          User?             @relation("DocumentationRevisionAuthor", fields: [authorId], references: [id], onDelete: SetNull)
  reviewer        User?             @relation("DocumentationRevisionReviewer", fields: [reviewedBy], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([pageId])
  @@index([authorId])
  @@index([revisionNumber])
  @@index([status])
  @@index([isPublished])
  @@index([needsReview])
  @@map("documentation_revisions")
}

model DocumentationWorkflow {
  id              String   @id @default(cuid())
  pageId          String
  workflowType    DocumentationWorkflowType
  status          DocumentationWorkflowStatus @default(PENDING)

  // Workflow participants
  requestedBy     String?
  assignedTo      String?
  reviewers       String[] // array of user IDs

  // Workflow details
  title           String
  description     String?  @db.Text
  priority        DocumentationWorkflowPriority @default(MEDIUM)
  dueDate         DateTime?

  // Progress tracking
  startedAt       DateTime?
  completedAt     DateTime?
  approvedAt      DateTime?
  rejectedAt      DateTime?

  // Workflow data
  workflowData    Json?    // additional workflow-specific data
  comments        Json?    // workflow comments/notes
  attachments     String[] // file attachments

  // Automation
  isAutomated     Boolean  @default(false)
  automationRule  String?  // ID of automation rule

  // Escalation
  escalatedAt     DateTime?
  escalatedTo     String?
  escalationReason String?

  // Relations
  page            DocumentationPage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  requester       User?             @relation("DocumentationWorkflowRequester", fields: [requestedBy], references: [id], onDelete: SetNull)
  assignee        User?             @relation("DocumentationWorkflowAssignee", fields: [assignedTo], references: [id], onDelete: SetNull)
  escalatedUser   User?             @relation("DocumentationWorkflowEscalated", fields: [escalatedTo], references: [id], onDelete: SetNull)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([pageId])
  @@index([workflowType])
  @@index([status])
  @@index([assignedTo])
  @@index([priority])
  @@index([dueDate])
  @@map("documentation_workflows")
}

model DocumentationExport {
  id              String   @id @default(cuid())
  workspaceId     String?
  requestedBy     String

  // Export configuration
  exportType      DocumentationExportType
  format          DocumentationExportFormat
  scope           DocumentationExportScope @default(SINGLE_PAGE)

  // Content selection
  pageIds         String[] // specific pages to export
  sectionIds      String[] // specific sections to export
  includeAnalytics Boolean @default(false)
  includeComments Boolean  @default(false)
  includeHistory  Boolean  @default(false)

  // Export settings
  title           String?
  description     String?
  includeTableOfContents Boolean @default(true)
  includeCoverPage Boolean @default(true)
  customStyling   Json?    // custom CSS/styling options

  // Status and results
  status          DocumentationExportStatus @default(PENDING)
  progress        Int      @default(0) // percentage complete
  fileUrl         String?  // URL to generated file
  fileName        String?
  fileSize        Int?     // file size in bytes
  downloadCount   Int      @default(0)

  // Processing metadata
  startedAt       DateTime?
  completedAt     DateTime?
  errorMessage    String?
  processingTime  Int?     // seconds

  // Expiration
  expiresAt       DateTime? // when download link expires
  isExpired       Boolean  @default(false)

  // Relations
  workspace       Workspace? @relation("WorkspaceDocumentationExports", fields: [workspaceId], references: [id], onDelete: Cascade)
  requester       User       @relation("DocumentationExportRequester", fields: [requestedBy], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([requestedBy])
  @@index([status])
  @@index([exportType])
  @@index([createdAt])
  @@map("documentation_exports")
}

// ========================================
// LIVE CHAT SUPPORT SYSTEM
// ========================================

model SupportAgent {
  id              String   @id @default(cuid())
  userId          String   @unique
  displayName     String
  title           String?  // e.g., "Senior Support Agent", "Technical Specialist"
  department      String   @default("support") // support, technical, sales, etc.
  isActive        Boolean  @default(true)
  isOnline        Boolean  @default(false)
  maxConcurrentChats Int   @default(5)
  currentChatCount   Int   @default(0)

  // Agent settings
  autoAssign      Boolean  @default(true)
  skills          String[] // e.g., ["technical", "billing", "api"]
  languages       String[] @default(["en"])
  timezone        String?

  // Status tracking
  lastSeen        DateTime @default(now())
  statusMessage   String?  // Custom status message

  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade, name: "SupportAgentUser")
  assignedChats   SupportChat[] @relation("AssignedAgent")
  messages        SupportMessage[] @relation("AgentMessages")
  contactForms    SupportContactForm[] @relation("ContactFormAgent")
  assignedTickets SupportTicket[] @relation("TicketAgent")
  ticketAssignments SupportTicketAssignment[] @relation(name: "AgentAssignments")
  ticketNotes     SupportTicketNote[] @relation(name: "AgentNotes")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([isActive])
  @@index([isOnline])
  @@index([department])
  @@index([lastSeen])
  @@map("support_agents")
}

model SupportChat {
  id              String   @id @default(cuid())
  workspaceId     String?  // null for guest users
  userId          String?  // null for guest users
  guestEmail      String?  // for guest users
  guestName       String?  // for guest users

  // Chat metadata
  subject         String?
  department      String   @default("support")
  priority        String   @default("medium") // low, medium, high, urgent
  status          String   @default("open") // open, assigned, resolved, closed

  // Assignment
  assignedAgentId String?
  assignedAt      DateTime?

  // Chat session info
  sessionId       String?  // Browser session ID
  userAgent       String?
  ipAddress       String?
  referrerUrl     String?

  // Timing
  firstResponseAt DateTime?
  resolvedAt      DateTime?
  closedAt        DateTime?

  // Satisfaction
  rating          Int?     // 1-5 rating
  feedback        String?  // User feedback

  // Tags and categorization
  tags            String[]
  category        String?  // billing, technical, general, etc.

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "SupportChatWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "SupportChatUser")
  assignedAgent   SupportAgent? @relation(fields: [assignedAgentId], references: [id], onDelete: SetNull, name: "AssignedAgent")
  messages        SupportMessage[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([userId])
  @@index([assignedAgentId])
  @@index([status])
  @@index([priority])
  @@index([department])
  @@index([createdAt])
  @@map("support_chats")
}

model SupportMessage {
  id              String   @id @default(cuid())
  chatId          String
  senderId        String?  // userId or agentId
  senderType      String   // "user", "agent", "system"
  senderName      String?  // Display name

  // Message content
  content         String   @db.Text
  messageType     String   @default("text") // text, file, image, system

  // File attachments
  attachments     Json?    // Array of attachment objects

  // Message metadata
  isInternal      Boolean  @default(false) // Internal agent notes
  isEdited        Boolean  @default(false)
  editedAt        DateTime?

  // Read status
  readByUser      Boolean  @default(false)
  readByAgent     Boolean  @default(false)
  readAt          DateTime?

  // Relations
  chat            SupportChat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  agent           SupportAgent? @relation(fields: [senderId], references: [id], onDelete: SetNull, name: "AgentMessages")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([chatId])
  @@index([senderId])
  @@index([senderType])
  @@index([createdAt])
  @@index([messageType])
  @@map("support_messages")
}

model SupportContactForm {
  id              String   @id @default(cuid())
  workspaceId     String?
  userId          String?

  // Contact info
  name            String
  email           String
  subject         String
  message         String   @db.Text
  department      String   @default("support")
  priority        String   @default("medium")

  // Additional context
  userAgent       String?
  ipAddress       String?
  referrerUrl     String?

  // Status
  status          String   @default("open") // open, assigned, resolved, closed
  assignedAgentId String?
  assignedAt      DateTime?
  respondedAt     DateTime?

  // Follow-up
  responseMessage String?  @db.Text
  responseMethod  String?  // email, phone, chat

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "ContactFormWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "ContactFormUser")
  assignedAgent   SupportAgent? @relation(fields: [assignedAgentId], references: [id], onDelete: SetNull, name: "ContactFormAgent")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([userId])
  @@index([status])
  @@index([department])
  @@index([createdAt])
  @@map("support_contact_forms")
}

// ========================================
// SUPPORT TICKET SYSTEM
// ========================================

model SupportTicket {
  id              String   @id @default(cuid())
  ticketNumber    String   @unique // e.g., "TICK-12345678"
  workspaceId     String?
  userId          String?

  // Ticket Info
  title           String
  description     String   @db.Text
  category        TicketCategory @default(GENERAL)
  priority        TicketPriority @default(MEDIUM)
  status          TicketStatus   @default(OPEN)
  type            TicketType     @default(SUPPORT)

  // Contact Info (for guest users)
  guestName       String?
  guestEmail      String?
  guestPhone      String?

  // Assignment
  assignedAgentId String?
  assignedAt      DateTime?

  // Resolution
  resolution      String?  @db.Text
  resolvedAt      DateTime?
  resolvedBy      String?  // Agent ID

  // SLA Tracking
  firstResponseAt DateTime?
  expectedResponseBy DateTime?
  slaBreached     Boolean  @default(false)

  // Metadata
  tags            String[]
  customFields    Json?    // Additional flexible data
  internalNotes   String?  @db.Text

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "TicketWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "TicketUser")
  assignedAgent   SupportAgent? @relation(fields: [assignedAgentId], references: [id], onDelete: SetNull, name: "TicketAgent")
  updates         TicketUpdate[]
  attachments     TicketAttachment[]
  assignments     SupportTicketAssignment[] @relation(name: "TicketAssignments")
  notes           SupportTicketNote[] @relation(name: "TicketNotes")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([userId])
  @@index([assignedAgentId])
  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([type])
  @@index([createdAt])
  @@index([ticketNumber])
  @@map("support_tickets")
}

model TicketUpdate {
  id              String   @id @default(cuid())
  ticketId        String

  // Update Info
  updateType      TicketUpdateType
  message         String?  @db.Text
  oldStatus       TicketStatus?
  newStatus       TicketStatus?
  oldPriority     TicketPriority?
  newPriority     TicketPriority?
  oldAssignee     String?  // Agent ID
  newAssignee     String?  // Agent ID

  // Author
  authorId        String?  // User or Agent ID
  authorType      String   // "user", "agent", "system"
  authorName      String?

  // Visibility
  isPublic        Boolean  @default(true)  // false for internal notes
  isResolution    Boolean  @default(false)

  // Relations
  ticket          SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())

  @@index([ticketId])
  @@index([authorId])
  @@index([updateType])
  @@index([createdAt])
  @@map("ticket_updates")
}

model TicketAttachment {
  id              String   @id @default(cuid())
  ticketId        String

  // File Info
  filename        String
  originalName    String
  fileSize        Int      // bytes
  mimeType        String
  fileUrl         String

  // Upload Info
  uploadedBy      String?  // User or Agent ID
  uploadedByType  String   // "user", "agent"
  uploadedByName  String?

  // Security
  isScanned       Boolean  @default(false)
  scanResult      String?  // "clean", "suspicious", "malware"

  // Relations
  ticket          SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())

  @@index([ticketId])
  @@index([uploadedBy])
  @@index([createdAt])
  @@map("ticket_attachments")
}

model SupportTicketAssignment {
  id        String   @id @default(cuid())
  ticketId  String
  agentId   String
  assignedAt DateTime @default(now())
  assignedBy String?  // User ID who made the assignment
  reason    String?  // Reason for assignment
  isActive  Boolean  @default(true)

  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade, name: "TicketAssignments")
  agent     SupportAgent @relation(fields: [agentId], references: [id], onDelete: Cascade, name: "AgentAssignments")

  @@index([ticketId])
  @@index([agentId])
  @@index([assignedAt])
  @@map("support_ticket_assignments")
}

model SupportTicketNote {
  id        String   @id @default(cuid())
  ticketId  String
  agentId   String
  content   String   @db.Text
  isInternal Boolean @default(true)
  tags      String[]
  createdAt DateTime @default(now())

  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade, name: "TicketNotes")
  agent     SupportAgent @relation(fields: [agentId], references: [id], onDelete: Cascade, name: "AgentNotes")

  @@index([ticketId])
  @@index([agentId])
  @@index([createdAt])
  @@map("support_ticket_notes")
}

// ========================================
// SUPPORT TICKET ENUMS
// ========================================

enum TicketCategory {
  GENERAL
  TECHNICAL
  BILLING
  FEATURE_REQUEST
  BUG_REPORT
  ACCOUNT
  INTEGRATION
  API
  SECURITY
  PERFORMANCE
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
  CRITICAL
}

enum TicketStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  PENDING_USER
  PENDING_AGENT
  RESOLVED
  CLOSED
  CANCELLED
}

enum TicketType {
  SUPPORT
  SALES
  TECHNICAL
  BILLING
  COMPLAINT
  COMPLIMENT
  SUGGESTION
}

enum TicketUpdateType {
  STATUS_CHANGE
  PRIORITY_CHANGE
  ASSIGNMENT_CHANGE
  USER_REPLY
  AGENT_REPLY
  INTERNAL_NOTE
  RESOLUTION
  ESCALATION
  SLA_BREACH
  SYSTEM_UPDATE
}

// ========================================
// COMMUNITY INTEGRATION SYSTEM
// ========================================

model CommunityForumPost {
  id              String   @id @default(cuid())
  workspaceId     String?
  userId          String?

  // Post Info
  title           String
  content         String   @db.Text
  category        ForumCategory @default(GENERAL)
  tags            String[]
  isPinned        Boolean  @default(false)
  isLocked        Boolean  @default(false)
  isResolved      Boolean  @default(false)

  // Engagement
  views           Int      @default(0)
  likes           Int      @default(0)
  repliesCount    Int      @default(0)
  lastActivity    DateTime @default(now())

  // Moderation
  isApproved      Boolean  @default(true)
  moderatedBy     String?
  moderatedAt     DateTime?

  // Guest posting
  guestName       String?
  guestEmail      String?

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "ForumPostWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "ForumPostUser")
  replies         CommunityForumReply[]
  votes           CommunityForumVote[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([userId])
  @@index([category])
  @@index([isApproved])
  @@index([lastActivity])
  @@index([views])
  @@map("community_forum_posts")
}

model CommunityForumReply {
  id              String   @id @default(cuid())
  postId          String
  userId          String?

  // Reply Info
  content         String   @db.Text
  isAccepted      Boolean  @default(false) // For marking best answer
  likes           Int      @default(0)

  // Guest reply
  guestName       String?
  guestEmail      String?

  // Moderation
  isApproved      Boolean  @default(true)
  moderatedBy     String?
  moderatedAt     DateTime?

  // Relations
  post            CommunityForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user            User?              @relation(fields: [userId], references: [id], onDelete: SetNull, name: "ForumReplyUser")
  votes           CommunityForumVote[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([postId])
  @@index([userId])
  @@index([isAccepted])
  @@index([createdAt])
  @@map("community_forum_replies")
}

model CommunityForumVote {
  id              String   @id @default(cuid())
  userId          String?
  postId          String?
  replyId         String?
  voteType        VoteType // UPVOTE or DOWNVOTE

  // Guest voting (by IP/session)
  guestIdentifier String?

  // Relations
  user            User?                @relation(fields: [userId], references: [id], onDelete: SetNull, name: "ForumVoteUser")
  post            CommunityForumPost?  @relation(fields: [postId], references: [id], onDelete: Cascade)
  reply           CommunityForumReply? @relation(fields: [replyId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())

  @@unique([userId, postId])
  @@unique([userId, replyId])
  @@unique([guestIdentifier, postId])
  @@unique([guestIdentifier, replyId])
  @@index([postId])
  @@index([replyId])
  @@map("community_forum_votes")
}

model FeatureRequest {
  id              String   @id @default(cuid())
  workspaceId     String?
  userId          String?

  // Request Info
  title           String
  description     String   @db.Text
  category        FeatureCategory @default(GENERAL)
  priority        RequestPriority @default(MEDIUM)
  status          RequestStatus   @default(SUBMITTED)

  // Implementation details
  estimatedEffort String?  // "small", "medium", "large"
  targetVersion   String?
  implementedAt   DateTime?

  // Engagement
  votes           Int      @default(0)
  views           Int      @default(0)
  commentsCount   Int      @default(0)

  // Guest request
  guestName       String?
  guestEmail      String?

  // Internal tracking
  internalNotes   String?  @db.Text
  assignedTo      String?  // Developer/team assigned
  githubIssueUrl  String?

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "FeatureRequestWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "FeatureRequestUser")
  userVotes       FeatureRequestVote[]
  comments        FeatureRequestComment[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([votes])
  @@index([createdAt])
  @@map("feature_requests")
}

model FeatureRequestVote {
  id              String   @id @default(cuid())
  requestId       String
  userId          String?

  // Guest voting
  guestIdentifier String?
  guestName       String?
  guestEmail      String?

  // Relations
  request         FeatureRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  user            User?          @relation(fields: [userId], references: [id], onDelete: SetNull, name: "FeatureVoteUser")

  createdAt       DateTime @default(now())

  @@unique([requestId, userId])
  @@unique([requestId, guestIdentifier])
  @@index([requestId])
  @@index([userId])
  @@map("feature_request_votes")
}

model FeatureRequestComment {
  id              String   @id @default(cuid())
  requestId       String
  userId          String?

  // Comment Info
  content         String   @db.Text
  isInternal      Boolean  @default(false) // Internal team comments

  // Guest comment
  guestName       String?
  guestEmail      String?

  // Relations
  request         FeatureRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  user            User?          @relation(fields: [userId], references: [id], onDelete: SetNull, name: "FeatureCommentUser")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([requestId])
  @@index([userId])
  @@index([isInternal])
  @@map("feature_request_comments")
}

model DiscordIntegration {
  id              String   @id @default(cuid())
  workspaceId     String   @unique

  // Discord Server Info
  guildId         String
  guildName       String
  guildIcon       String?
  inviteUrl       String

  // Channel Mappings
  channels        Json     // {general: "channel_id", support: "channel_id", announcements: "channel_id"}

  // Webhook Integration
  webhookUrl      String?
  webhookSecret   String?

  // Activity Tracking
  memberCount     Int      @default(0)
  onlineMembers   Int      @default(0)
  lastActivity    DateTime @default(now())

  // Settings
  isActive        Boolean  @default(true)
  autoAnnounce    Boolean  @default(false) // Auto-announce new features/updates

  // Relations
  workspace       Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade, name: "DiscordWorkspace")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([workspaceId])
  @@index([guildId])
  @@map("discord_integrations")
}

model CommunityActivity {
  id              String   @id @default(cuid())
  workspaceId     String?

  // Activity Info
  activityType    CommunityActivityType
  title           String
  description     String?

  // Actor Info
  userId          String?
  userName        String
  userAvatar      String?

  // Target Info
  targetId        String?  // ID of post, feature request, etc.
  targetType      String?  // "forum_post", "feature_request", etc.
  targetTitle     String?

  // Metadata
  metadata        Json?    // Additional activity-specific data

  // Relations
  workspace       Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull, name: "CommunityActivityWorkspace")
  user            User?      @relation(fields: [userId], references: [id], onDelete: SetNull, name: "CommunityActivityUser")

  createdAt       DateTime @default(now())

  @@index([workspaceId])
  @@index([activityType])
  @@index([createdAt])
  @@index([targetType])
  @@map("community_activities")
}

// ========================================
// COMMUNITY ENUMS
// ========================================

enum ForumCategory {
  GENERAL
  SUPPORT
  FEATURE_REQUESTS
  ANNOUNCEMENTS
  DEVELOPMENT
  INTEGRATIONS
  FEEDBACK
  SHOWCASE
  OFF_TOPIC
}

enum VoteType {
  UPVOTE
  DOWNVOTE
}

enum FeatureCategory {
  GENERAL
  UI_UX
  INTEGRATIONS
  API
  ANALYTICS
  AUTOMATION
  MOBILE
  PERFORMANCE
  SECURITY
  ACCESSIBILITY
}

enum RequestPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RequestStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  IN_DEVELOPMENT
  TESTING
  COMPLETED
  REJECTED
  DUPLICATE
}

enum CommunityActivityType {
  FORUM_POST_CREATED
  FORUM_REPLY_CREATED
  FEATURE_REQUEST_CREATED
  FEATURE_REQUEST_VOTED
  FEATURE_REQUEST_COMMENTED
  DISCORD_MEMBER_JOINED
  DISCORD_MESSAGE_POSTED
  USER_JOINED_COMMUNITY
  MILESTONE_REACHED
  ANNOUNCEMENT_POSTED
}

// Help Article Management System Models

model HelpArticleRevision {
  id              String      @id @default(cuid())
  articleId       String
  version         Int
  title           String
  content         String      @db.Text
  excerpt         String?
  categoryId      String
  tags            String[]
  status          String
  seoTitle        String?
  seoDescription  String?
  changeSummary   String?     // Summary of changes made
  authorId        String?

  createdAt       DateTime    @default(now())

  // Relations
  article         HelpArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)
  author          User?       @relation("HelpArticleRevisionAuthor", fields: [authorId], references: [id], onDelete: SetNull)

  @@unique([articleId, version])
  @@index([articleId])
  @@index([createdAt])
  @@map("help_article_revisions")
}

model HelpArticleWorkflow {
  id              String      @id @default(cuid())
  articleId       String
  workflowType    String      // create, update, delete, publish, archive
  status          String      @default("pending") // pending, approved, rejected, completed
  requestedById   String
  assignedToId    String?
  reviewedById    String?

  // Content being reviewed
  proposedTitle   String?
  proposedContent String?     @db.Text
  proposedExcerpt String?
  proposedCategoryId String?
  proposedTags    String[]
  proposedSeoTitle String?
  proposedSeoDescription String?

  // Review details
  reviewComments  String?     @db.Text
  reviewedAt      DateTime?
  approvedAt      DateTime?
  rejectedAt      DateTime?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  article         HelpArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)
  requestedBy     User        @relation("WorkflowRequestedBy", fields: [requestedById], references: [id], onDelete: Cascade)
  assignedTo      User?       @relation("WorkflowAssignedTo", fields: [assignedToId], references: [id], onDelete: SetNull)
  reviewedBy      User?       @relation("WorkflowReviewedBy", fields: [reviewedById], references: [id], onDelete: SetNull)

  @@index([articleId])
  @@index([status])
  @@index([requestedById])
  @@index([assignedToId])
  @@index([createdAt])
  @@map("help_article_workflows")
}

model HelpArticleMedia {
  id              String      @id @default(cuid())
  articleId       String
  fileName        String
  originalName    String
  mimeType        String
  fileSize        Int
  filePath        String
  alt             String?
  caption         String?
  sortOrder       Int         @default(0)

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  article         HelpArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([sortOrder])
  @@map("help_article_media")
}

model HelpArticleTemplate {
  id              String      @id @default(cuid())
  name            String
  description     String?
  content         String      @db.Text
  category        String      // tutorial, faq, api_doc, feature_guide, etc.
  tags            String[]
  isActive        Boolean     @default(true)
  usageCount      Int         @default(0)
  authorId        String?

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  author          User?       @relation("HelpArticleTemplateAuthor", fields: [authorId], references: [id], onDelete: SetNull)

  @@index([category])
  @@index([isActive])
  @@index([authorId])
  @@map("help_article_templates")
}

model HelpArticleAnalytics {
  id              String      @id @default(cuid())
  articleId       String
  eventType       String      // view, rating, search, share, etc.
  views           Int?        @default(0)
  timeOnPage      Int?        // in seconds
  rating          Float?      // 1-5 star rating
  helpful         Boolean?    // helpful/not helpful vote
  searchQuery     String?     // if event was from search
  userAgent       String?
  ipAddress       String?
  timestamp       DateTime    @default(now())

  // Relations
  article         HelpArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([eventType])
  @@index([timestamp])
  @@map("help_article_analytics")
}

model HelpArticleRelation {
  id              String      @id @default(cuid())
  fromArticleId   String
  toArticleId     String
  relationType    String      @default("related") // related, prerequisite, followup, alternative
  isAutoGenerated Boolean     @default(false)
  strength        Float       @default(0.5) // 0-1 relationship strength
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  fromArticle     HelpArticle @relation("ArticleRelationsFrom", fields: [fromArticleId], references: [id], onDelete: Cascade)
  toArticle       HelpArticle @relation("ArticleRelationsTo", fields: [toArticleId], references: [id], onDelete: Cascade)

  @@unique([fromArticleId, toArticleId])
  @@index([fromArticleId])
  @@index([toArticleId])
  @@index([relationType])
  @@map("help_article_relations")
}

model HelpCategoryAnalytics {
  id              String      @id @default(cuid())
  categoryId      String
  date            DateTime    @db.Date
  totalViews      Int         @default(0)
  totalArticles   Int         @default(0)
  publishedArticles Int       @default(0)
  averageRating   Float?

  // Relations
  category        HelpCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, date])
  @@index([categoryId])
  @@index([date])
  @@map("help_category_analytics")
}

// Enums for Help Article Management

enum ArticleWorkflowType {
  CREATE
  UPDATE
  DELETE
  PUBLISH
  ARCHIVE
  REVIEW
}

enum ArticleWorkflowStatus {
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

// ========================================
// COMMUNITY MODERATION SYSTEM
// ========================================

model ModerationAction {
  id              String              @id @default(cuid())
  workspaceId     String
  moderatorId     String?

  // Action Details
  actionType      ModerationActionType
  targetType      ModerationTargetType
  targetId        String
  reason          String?
  description     String?             @db.Text

  // Action Data
  previousData    Json?               // Original state before action
  newData         Json?               // State after action

  // Automatic vs Manual
  isAutomatic     Boolean             @default(false)
  ruleId          String?             // Reference to auto-moderation rule

  // Status
  status          ModerationStatus    @default(PENDING)
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?

  // Metadata
  ipAddress       String?
  userAgent       String?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceModerationActions", fields: [workspaceId], references: [id], onDelete: Cascade)
  moderator       User?               @relation("ModeratorActions", fields: [moderatorId], references: [id], onDelete: SetNull)
  reviewer        User?               @relation("ReviewerActions", fields: [reviewedBy], references: [id], onDelete: SetNull)
  rule            AutoModerationRule? @relation(fields: [ruleId], references: [id], onDelete: SetNull)

  @@index([workspaceId])
  @@index([targetType, targetId])
  @@index([actionType])
  @@index([status])
  @@index([createdAt])
  @@map("moderation_actions")
}

model UserModerationHistory {
  id              String              @id @default(cuid())
  workspaceId     String
  userId          String
  moderatorId     String?

  // Moderation Details
  actionType      UserModerationAction
  reason          String
  description     String?             @db.Text

  // Duration and Restrictions
  startDate       DateTime            @default(now())
  endDate         DateTime?
  isActive        Boolean             @default(true)

  // Appeals
  canAppeal       Boolean             @default(true)
  appealedAt      DateTime?
  appealReason    String?             @db.Text
  appealStatus    AppealStatus        @default(NONE)
  appealResolvedBy String?
  appealResolvedAt DateTime?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceUserModerations", fields: [workspaceId], references: [id], onDelete: Cascade)
  user            User                @relation("UserModerations", fields: [userId], references: [id], onDelete: Cascade)
  moderator       User?               @relation("ModeratorUserActions", fields: [moderatorId], references: [id], onDelete: SetNull)
  appealResolver  User?               @relation("AppealResolvers", fields: [appealResolvedBy], references: [id], onDelete: SetNull)

  @@index([workspaceId])
  @@index([userId])
  @@index([actionType])
  @@index([isActive])
  @@index([endDate])
  @@map("user_moderation_history")
}

model ContentReport {
  id              String              @id @default(cuid())
  workspaceId     String
  reporterId      String?

  // Reported Content
  contentType     ModerationTargetType
  contentId       String
  contentUrl      String?

  // Report Details
  reportReason    ReportReason
  customReason    String?
  description     String?             @db.Text
  evidence        Json?               // Screenshots, links, etc.

  // Guest Reporter Info
  guestName       String?
  guestEmail      String?
  guestIp         String?

  // Processing
  status          ReportStatus        @default(PENDING)
  priority        ReportPriority      @default(MEDIUM)
  assignedTo      String?
  resolution      String?             @db.Text
  resolvedAt      DateTime?

  // Auto-Processing
  autoProcessed   Boolean             @default(false)
  confidenceScore Float?              // 0-1 confidence in report validity

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceContentReports", fields: [workspaceId], references: [id], onDelete: Cascade)
  reporter        User?               @relation("UserReports", fields: [reporterId], references: [id], onDelete: SetNull)
  assignedModerator User?             @relation("AssignedReports", fields: [assignedTo], references: [id], onDelete: SetNull)

  @@index([workspaceId])
  @@index([contentType, contentId])
  @@index([status])
  @@index([priority])
  @@index([reportReason])
  @@index([createdAt])
  @@map("content_reports")
}

model AutoModerationRule {
  id              String              @id @default(cuid())
  workspaceId     String

  // Rule Configuration
  name            String
  description     String?
  isActive        Boolean             @default(true)

  // Trigger Conditions
  triggerType     AutoModerationTrigger
  conditions      Json                // Flexible condition configuration

  // Content Types
  targetTypes     ModerationTargetType[]

  // Actions
  actions         Json                // Array of actions to take

  // Thresholds
  confidenceThreshold Float           @default(0.8)

  // Settings
  requiresReview  Boolean             @default(false)
  notifyModerators Boolean            @default(true)
  escalateAfter   Int?                // Minutes before escalation

  // Statistics
  triggeredCount  Int                 @default(0)
  falsePositives  Int                 @default(0)
  lastTriggered   DateTime?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String

  // Relations
  workspace       Workspace           @relation("WorkspaceAutoModerationRules", fields: [workspaceId], references: [id], onDelete: Cascade)
  creator         User                @relation("CreatedModerationRules", fields: [createdBy], references: [id], onDelete: Cascade)
  actions         ModerationAction[]

  @@index([workspaceId])
  @@index([isActive])
  @@index([triggerType])
  @@map("auto_moderation_rules")
}

model SpamDetection {
  id              String              @id @default(cuid())
  workspaceId     String

  // Content Details
  contentType     ModerationTargetType
  contentId       String
  content         String              @db.Text

  // Detection Results
  isSpam          Boolean
  confidenceScore Float               // 0-1 confidence level
  spamType        SpamType

  // Detection Factors
  detectionFactors Json               // Detailed analysis factors

  // Pattern Matching
  matchedPatterns String[]
  suspiciousWords String[]

  // Behavioral Analysis
  authorId        String?
  authorReputation Float?
  postFrequency   Int?                // Posts per hour

  // Action Taken
  actionTaken     String?
  reviewRequired  Boolean             @default(false)

  createdAt       DateTime            @default(now())

  // Relations
  workspace       Workspace           @relation("WorkspaceSpamDetections", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([contentType, contentId])
  @@index([isSpam])
  @@index([confidenceScore])
  @@index([spamType])
  @@map("spam_detections")
}

model ModerationQueue {
  id              String              @id @default(cuid())
  workspaceId     String

  // Queue Item Details
  itemType        ModerationTargetType
  itemId          String
  priority        QueuePriority       @default(MEDIUM)

  // Assignment
  assignedTo      String?
  assignedAt      DateTime?

  // Processing
  status          QueueStatus         @default(PENDING)
  dueDate         DateTime?
  estimatedTime   Int?                // Minutes

  // Context
  source          String              // "auto_detection", "user_report", "manual_review"
  context         Json?               // Additional context data

  // Escalation
  escalationLevel Int                 @default(0)
  escalatedAt     DateTime?
  escalatedBy     String?

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceModerationQueue", fields: [workspaceId], references: [id], onDelete: Cascade)
  assignedModerator User?             @relation("AssignedQueueItems", fields: [assignedTo], references: [id], onDelete: SetNull)
  escalator       User?               @relation("QueueEscalators", fields: [escalatedBy], references: [id], onDelete: SetNull)

  @@index([workspaceId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@index([assignedTo])
  @@map("moderation_queue")
}

model CommunityAnalytics {
  id              String              @id @default(cuid())
  workspaceId     String
  date            DateTime            @db.Date

  // Content Metrics
  totalPosts      Int                 @default(0)
  totalReplies    Int                 @default(0)
  totalReports    Int                 @default(0)
  totalModerations Int               @default(0)

  // User Metrics
  activeUsers     Int                 @default(0)
  newUsers        Int                 @default(0)
  bannedUsers     Int                 @default(0)

  // Engagement Metrics
  totalViews      Int                 @default(0)
  totalVotes      Int                 @default(0)
  avgResponseTime Float?              // Hours

  // Health Scores
  communityHealth Float               @default(50) // 0-100
  moderationLoad  Float               @default(0)  // Percentage
  userSatisfaction Float?             // 0-100

  // Spam & Content Quality
  spamDetected    Int                 @default(0)
  falsePositives  Int                 @default(0)
  contentQuality  Float               @default(50) // 0-100

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  workspace       Workspace           @relation("WorkspaceCommunityAnalytics", fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, date])
  @@index([workspaceId])
  @@index([date])
  @@map("community_analytics")
}

// ========================================
// MODERATION ENUMS
// ========================================

enum ModerationActionType {
  APPROVE
  REJECT
  DELETE
  EDIT
  PIN
  UNPIN
  LOCK
  UNLOCK
  FEATURE
  UNFEATURE
  MERGE
  SPLIT
  MOVE
  HIDE
  RESTORE
  FLAG
  UNFLAG
}

enum ModerationTargetType {
  FORUM_POST
  FORUM_REPLY
  FEATURE_REQUEST
  FEATURE_COMMENT
  USER_PROFILE
  COMMENT
  MESSAGE
}

enum ModerationStatus {
  PENDING
  APPROVED
  REJECTED
  ESCALATED
  COMPLETED
}

enum UserModerationAction {
  WARNING
  TEMPORARY_BAN
  PERMANENT_BAN
  MUTE
  RESTRICT_POSTING
  REMOVE_PRIVILEGES
  PROMOTE
  DEMOTE
}

enum AppealStatus {
  NONE
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum ReportReason {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  MISINFORMATION
  OFFENSIVE_LANGUAGE
  OFF_TOPIC
  DUPLICATE
  TECHNICAL_ISSUE
  OTHER
}

enum ReportStatus {
  PENDING
  IN_REVIEW
  RESOLVED
  DISMISSED
  ESCALATED
}

enum ReportPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AutoModerationTrigger {
  KEYWORD_MATCH
  SPAM_DETECTION
  TOXICITY_DETECTION
  DUPLICATE_CONTENT
  RATE_LIMITING
  REPUTATION_BASED
  PATTERN_MATCHING
  AI_CLASSIFICATION
}

enum SpamType {
  PROMOTIONAL
  REPETITIVE
  MALICIOUS_LINKS
  FAKE_ENGAGEMENT
  IRRELEVANT_CONTENT
  AUTOMATED_POSTING
}

enum QueuePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum QueueStatus {
  PENDING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

// ========================================
// DOCUMENTATION MANAGEMENT ENUMS
// ========================================

enum DocumentationStatus {
  DRAFT
  REVIEW
  PUBLISHED
  ARCHIVED
}

enum DocumentationVisibility {
  PUBLIC
  INTERNAL
  PRIVATE
}

enum DocumentationCodeLanguage {
  JAVASCRIPT
  TYPESCRIPT
  PYTHON
  JAVA
  CSHARP
  CPP
  PHP
  RUBY
  GO
  RUST
  KOTLIN
  SWIFT
  SHELL
  SQL
  HTML
  CSS
  JSON
  YAML
  MARKDOWN
  OTHER
}

enum DocumentationCommentType {
  GENERAL
  SUGGESTION
  CORRECTION
  QUESTION
  APPROVAL
}

enum DocumentationExportFormat {
  PDF
  HTML
  MARKDOWN
  CONFLUENCE
  NOTION
  DOCX
}

enum DocumentationWorkflowType {
  CREATE
  UPDATE
  DELETE
  PUBLISH
  ARCHIVE
  REVIEW
}

enum DocumentationWorkflowStatus {
  PENDING
  IN_PROGRESS
  APPROVED
  REJECTED
  COMPLETED
}

// ========================================
// USER ROLE & PERMISSION MANAGEMENT MODELS
// ========================================

model Role {
  id          String   @id @default(cuid())
  name        String   @unique
  displayName String
  description String?
  permissions String[] // Array of permission strings
  isSystem    Boolean  @default(false) // Cannot be deleted if true
  isActive    Boolean  @default(true)
  color       String?  // For UI display
  priority    Int      @default(0) // Higher priority overrides lower
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userWorkspaces UserWorkspace[]
  userRoles      UserRole[]
  auditLogs      AuditLog[]       @relation("RoleAuditLogs")

  @@map("roles")
}

model UserRole {
  id        String   @id @default(cuid())
  userId    String
  roleId    String
  assignedAt DateTime @default(now())
  assignedBy String
  expiresAt DateTime?
  isActive  Boolean  @default(true)

  // Relations
  user       User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role       Role @relation(fields: [roleId], references: [id], onDelete: Cascade)
  assignedByUser User @relation("UserRoleAssignments", fields: [assignedBy], references: [id])

  @@unique([userId, roleId])
  @@map("user_roles")
}

model Permission {
  id          String  @id @default(cuid())
  name        String  @unique
  displayName String
  description String?
  category    String  // e.g., "users", "posts", "analytics"
  resource    String  // e.g., "user", "post", "campaign"
  action      String  // e.g., "create", "read", "update", "delete"
  conditions  Json?   // Additional conditions for the permission

  @@map("permissions")
}

model Team {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  description String?
  color       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  workspace   Workspace    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  members     TeamMember[]
  auditLogs   AuditLog[]   @relation("TeamAuditLogs")

  @@unique([workspaceId, name])
  @@map("teams")
}

model TeamMember {
  id       String   @id @default(cuid())
  teamId   String
  userId   String
  role     TeamRole @default(MEMBER)
  joinedAt DateTime @default(now())

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

model UserSession {
  id            String    @id @default(cuid())
  userId        String
  sessionToken  String    @unique
  ipAddress     String?
  userAgent     String?
  location      Json?     // Country, city, etc.
  deviceInfo    Json?     // Device type, OS, browser
  startedAt     DateTime  @default(now())
  lastActiveAt  DateTime  @default(now())
  endedAt       DateTime?
  isActive      Boolean   @default(true)

  // Relations
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  activities UserActivity[]

  @@map("user_sessions")
}

model UserActivity {
  id          String    @id @default(cuid())
  userId      String
  sessionId   String?
  workspaceId String?
  action      String    // e.g., "login", "create_post", "view_analytics"
  resource    String?   // e.g., "post", "campaign", "user"
  resourceId  String?   // ID of the resource
  metadata    Json?     // Additional context data
  ipAddress   String?
  userAgent   String?
  timestamp   DateTime  @default(now())

  // Relations
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  session   UserSession? @relation(fields: [sessionId], references: [id], onDelete: SetNull)
  workspace Workspace?   @relation(fields: [workspaceId], references: [id], onDelete: SetNull)

  @@index([userId, timestamp])
  @@index([workspaceId, timestamp])
  @@index([action, timestamp])
  @@map("user_activities")
}

model AuditLog {
  id          String    @id @default(cuid())
  userId      String?
  workspaceId String?
  teamId      String?
  roleId      String?
  action      String    // e.g., "user_created", "role_assigned", "permission_changed"
  resource    String    // e.g., "user", "role", "workspace"
  resourceId  String?
  oldValues   Json?     // Previous state
  newValues   Json?     // New state
  changes     Json?     // Specific changes made
  ipAddress   String?
  userAgent   String?
  timestamp   DateTime  @default(now())

  // Relations
  user      User?      @relation(fields: [userId], references: [id], onDelete: SetNull)
  workspace Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull)
  team      Team?      @relation("TeamAuditLogs", fields: [teamId], references: [id], onDelete: SetNull)
  role      Role?      @relation("RoleAuditLogs", fields: [roleId], references: [id], onDelete: SetNull)

  @@index([userId, timestamp])
  @@index([workspaceId, timestamp])
  @@index([action, timestamp])
  @@map("audit_logs")
}

model UserInvitation {
  id          String           @id @default(cuid())
  email       String
  workspaceId String?
  teamId      String?
  roleIds     String[]         // Array of role IDs to assign
  invitedBy   String
  message     String?
  token       String           @unique
  status      InvitationStatus @default(PENDING)
  expiresAt   DateTime
  acceptedAt  DateTime?
  createdAt   DateTime         @default(now())

  // Relations
  workspace   Workspace? @relation(fields: [workspaceId], references: [id], onDelete: SetNull)
  team        Team?      @relation("TeamInvitations", fields: [teamId], references: [id], onDelete: SetNull)
  invitedByUser User     @relation("SentInvitations", fields: [invitedBy], references: [id])

  @@map("user_invitations")
}

model SSOProvider {
  id           String  @id @default(cuid())
  name         String  @unique
  displayName  String
  type         SSOType
  clientId     String
  clientSecret String  // Encrypted
  issuerUrl    String?
  metadataUrl  String?
  config       Json?   // Provider-specific configuration
  isActive     Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  accounts SSOAccount[]

  @@map("sso_providers")
}

model SSOAccount {
  id           String  @id @default(cuid())
  userId       String
  providerId   String
  providerUserId String
  email        String?
  name         String?
  avatarUrl    String?
  accessToken  String? // Encrypted
  refreshToken String? // Encrypted
  expiresAt    DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user     User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider SSOProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@unique([providerId, providerUserId])
  @@map("sso_accounts")
}

// ========================================
// USER ROLE & PERMISSION MANAGEMENT ENUMS
// ========================================

enum TeamRole {
  LEADER
  MEMBER
  VIEWER
}

enum SSOType {
  OAUTH2
  SAML
  LDAP
  OIDC
}
